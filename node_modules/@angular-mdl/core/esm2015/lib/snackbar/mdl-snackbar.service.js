import { Component, ComponentFactoryResolver, Injectable, ViewEncapsulation, } from "@angular/core";
import { MdlDialogOutletService } from "../dialog-outlet/mdl-dialog-outlet.service";
import { Subject } from "rxjs";
import * as i0 from "@angular/core";
import * as i1 from "../dialog-outlet/mdl-dialog-outlet.service";
const ANIMATION_TIME = 250;
export class MdlSnackbarComponent {
    constructor() {
        this.showIt = false;
    }
    onClick() {
        this.onAction();
    }
    isActive() {
        return this.showIt;
    }
    show() {
        const result = new Subject();
        // wait unit the dom is in place - then showIt will change the css class
        setTimeout(() => {
            this.showIt = true;
            // fire after the view animation is done
            setTimeout(() => {
                result.next();
                result.complete();
            }, ANIMATION_TIME);
        }, ANIMATION_TIME);
        return result.asObservable();
    }
    hide() {
        this.showIt = false;
        const result = new Subject();
        // fire after the view animation is done
        setTimeout(() => {
            result.next(null);
            result.complete();
        }, ANIMATION_TIME);
        return result.asObservable();
    }
}
MdlSnackbarComponent.decorators = [
    { type: Component, args: [{
                selector: "mdl-snackbar-component",
                template: `
    <div
      id="demo-toast-example"
      class=" mdl-snackbar"
      [ngClass]="{ 'mdl-snackbar--active': showIt }"
    >
      <div class="mdl-snackbar__text">{{ message }}</div>
      <button
        *ngIf="onAction"
        class="mdl-snackbar__action"
        type="button"
        (click)="onClick()"
      >
        {{ actionText }}
      </button>
    </div>
  `,
                encapsulation: ViewEncapsulation.None
            },] }
];
export class MdlSnackbarService {
    constructor(componentFactoryResolver, dialogOutletService) {
        this.componentFactoryResolver = componentFactoryResolver;
        this.dialogOutletService = dialogOutletService;
        this.cFactory = this.componentFactoryResolver.resolveComponentFactory(MdlSnackbarComponent);
    }
    showToast(message, timeout) {
        return this.showSnackbar({
            message,
            timeout,
        });
    }
    showSnackbar(snackbarMessage) {
        const optTimeout = snackbarMessage.timeout || 2750;
        const closeAfterTimeout = !!snackbarMessage.closeAfterTimeout;
        const viewContainerRef = this.dialogOutletService.viewContainerRef;
        if (!viewContainerRef) {
            throw new Error("You did not provide a ViewContainerRef. " +
                "Please see https://github.com/mseemann/angular2-mdl/wiki/How-to-use-the-MdlDialogService");
        }
        const cRef = viewContainerRef.createComponent(this.cFactory, viewContainerRef.length);
        const mdlSnackbarComponent = cRef.instance;
        mdlSnackbarComponent.message = snackbarMessage.message;
        if (this.previousSnack) {
            const previousSnack = this.previousSnack;
            const subscription = previousSnack.component.hide().subscribe(() => {
                previousSnack.cRef.destroy();
                subscription.unsubscribe();
            });
        }
        this.previousSnack = {
            component: mdlSnackbarComponent,
            cRef,
        };
        if (snackbarMessage.action) {
            if (closeAfterTimeout) {
                this.hideAndDestroySnack(mdlSnackbarComponent, cRef, optTimeout);
            }
            mdlSnackbarComponent.actionText = snackbarMessage.action.text;
            mdlSnackbarComponent.onAction = () => {
                mdlSnackbarComponent.hide().subscribe(() => {
                    cRef.destroy();
                    snackbarMessage.action.handler();
                });
            };
        }
        else {
            this.hideAndDestroySnack(mdlSnackbarComponent, cRef, optTimeout);
        }
        const result = new Subject();
        mdlSnackbarComponent.show().subscribe(() => {
            result.next(mdlSnackbarComponent);
            result.complete();
        });
        return result.asObservable();
    }
    hideAndDestroySnack(component, componentRef, timeOut) {
        setTimeout(() => {
            component.hide().subscribe(() => {
                componentRef.destroy();
            });
        }, timeOut);
    }
}
MdlSnackbarService.ɵprov = i0.ɵɵdefineInjectable({ factory: function MdlSnackbarService_Factory() { return new MdlSnackbarService(i0.ɵɵinject(i0.ComponentFactoryResolver), i0.ɵɵinject(i1.MdlDialogOutletService)); }, token: MdlSnackbarService, providedIn: "root" });
MdlSnackbarService.decorators = [
    { type: Injectable, args: [{
                providedIn: "root",
            },] }
];
MdlSnackbarService.ctorParameters = () => [
    { type: ComponentFactoryResolver },
    { type: MdlDialogOutletService }
];
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibWRsLXNuYWNrYmFyLnNlcnZpY2UuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi8uLi9wcm9qZWN0cy9jb3JlL3NyYy9saWIvc25hY2tiYXIvbWRsLXNuYWNrYmFyLnNlcnZpY2UudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUNMLFNBQVMsRUFFVCx3QkFBd0IsRUFFeEIsVUFBVSxFQUNWLGlCQUFpQixHQUNsQixNQUFNLGVBQWUsQ0FBQztBQUN2QixPQUFPLEVBQUUsc0JBQXNCLEVBQUUsTUFBTSw0Q0FBNEMsQ0FBQztBQUNwRixPQUFPLEVBQWMsT0FBTyxFQUFFLE1BQU0sTUFBTSxDQUFDOzs7QUFFM0MsTUFBTSxjQUFjLEdBQUcsR0FBRyxDQUFDO0FBdUIzQixNQUFNLE9BQU8sb0JBQW9CO0lBckJqQztRQXdCRSxXQUFNLEdBQUcsS0FBSyxDQUFDO0lBdUNqQixDQUFDO0lBcENDLE9BQU87UUFDTCxJQUFJLENBQUMsUUFBUSxFQUFFLENBQUM7SUFDbEIsQ0FBQztJQUVELFFBQVE7UUFDTixPQUFPLElBQUksQ0FBQyxNQUFNLENBQUM7SUFDckIsQ0FBQztJQUVELElBQUk7UUFDRixNQUFNLE1BQU0sR0FBa0IsSUFBSSxPQUFPLEVBQUUsQ0FBQztRQUM1Qyx3RUFBd0U7UUFDeEUsVUFBVSxDQUFDLEdBQUcsRUFBRTtZQUNkLElBQUksQ0FBQyxNQUFNLEdBQUcsSUFBSSxDQUFDO1lBQ25CLHdDQUF3QztZQUN4QyxVQUFVLENBQUMsR0FBRyxFQUFFO2dCQUNkLE1BQU0sQ0FBQyxJQUFJLEVBQUUsQ0FBQztnQkFDZCxNQUFNLENBQUMsUUFBUSxFQUFFLENBQUM7WUFDcEIsQ0FBQyxFQUFFLGNBQWMsQ0FBQyxDQUFDO1FBQ3JCLENBQUMsRUFBRSxjQUFjLENBQUMsQ0FBQztRQUVuQixPQUFPLE1BQU0sQ0FBQyxZQUFZLEVBQUUsQ0FBQztJQUMvQixDQUFDO0lBRUQsSUFBSTtRQUNGLElBQUksQ0FBQyxN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QUFDO2dCQUNuQyxDQUFDLENBQUMsQ0FBQztZQUNMLENBQUMsQ0FBQztTQUNIO2FBQU07WUFDTCxJQUFJLENBQUMsbUJBQW1CLENBQUMsb0JBQW9CLEVBQUUsSUFBSSxFQUFFLFVBQVUsQ0FBQyxDQUFDO1NBQ2xFO1FBRUQsTUFBTSxNQUFNLEdBQWtDLElBQUksT0FBTyxFQUF3QixDQUFDO1FBRWxGLG9CQUFvQixDQUFDLElBQUksRUFBRSxDQUFDLFNBQVMsQ0FBQyxHQUFHLEVBQUU7WUFDekMsTUFBTSxDQUFDLElBQUksQ0FBQyxvQkFBb0IsQ0FBQyxDQUFDO1lBQ2xDLE1BQU0sQ0FBQyxRQUFRLEVBQUUsQ0FBQztRQUNwQixDQUFDLENBQUMsQ0FBQztRQUVILE9BQU8sTUFBTSxDQUFDLFlBQVksRUFBRSxDQUFDO0lBQy9CLENBQUM7SUFFTyxtQkFBbUIsQ0FBQyxTQUFTLEVBQUUsWUFBWSxFQUFFLE9BQU87UUFDMUQsVUFBVSxDQUFDLEdBQUcsRUFBRTtZQUNkLFNBQVMsQ0FBQyxJQUFJLEVBQUUsQ0FBQyxTQUFTLENBQUMsR0FBRyxFQUFFO2dCQUM5QixZQUFZLENBQUMsT0FBTyxFQUFFLENBQUM7WUFDekIsQ0FBQyxDQUFDLENBQUM7UUFDTCxDQUFDLEVBQUUsT0FBTyxDQUFDLENBQUM7SUFDZCxDQUFDOzs7O1lBL0ZGLFVBQVUsU0FBQztnQkFDVixVQUFVLEVBQUUsTUFBTTthQUNuQjs7O1lBdkZDLHdCQUF3QjtZQUtqQixzQkFBc0IiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge1xuICBDb21wb25lbnQsXG4gIENvbXBvbmVudEZhY3RvcnksXG4gIENvbXBvbmVudEZhY3RvcnlSZXNvbHZlcixcbiAgQ29tcG9uZW50UmVmLFxuICBJbmplY3RhYmxlLFxuICBWaWV3RW5jYXBzdWxhdGlvbixcbn0gZnJvbSBcIkBhbmd1bGFyL2NvcmVcIjtcbmltcG9ydCB7IE1kbERpYWxvZ091dGxldFNlcnZpY2UgfSBmcm9tIFwiLi4vZGlhbG9nLW91dGxldC9tZGwtZGlhbG9nLW91dGxldC5zZXJ2aWNlXCI7XG5pbXBvcnQgeyBPYnNlcnZhYmxlLCBTdWJqZWN0IH0gZnJvbSBcInJ4anNcIjtcblxuY29uc3QgQU5JTUFUSU9OX1RJTUUgPSAyNTA7XG5cbkBDb21wb25lbnQoe1xuICBzZWxlY3RvcjogXCJtZGwtc25hY2tiYXItY29tcG9uZW50XCIsXG4gIHRlbXBsYXRlOiBgXG4gICAgPGRpdlxuICAgICAgaWQ9XCJkZW1vLXRvYXN0LWV4YW1wbGVcIlxuICAgICAgY2xhc3M9XCIgbWRsLXNuYWNrYmFyXCJcbiAgICAgIFtuZ0NsYXNzXT1cInsgJ21kbC1zbmFja2Jhci0tYWN0aXZlJzogc2hvd0l0IH1cIlxuICAgID5cbiAgICAgIDxkaXYgY2xhc3M9XCJtZGwtc25hY2tiYXJfX3RleHRcIj57eyBtZXNzYWdlIH19PC9kaXY+XG4gICAgICA8YnV0dG9uXG4gICAgICAgICpuZ0lmPVwib25BY3Rpb25cIlxuICAgICAgICBjbGFzcz1cIm1kbC1zbmFja2Jhcl9fYWN0aW9uXCJcbiAgICAgICAgdHlwZT1cImJ1dHRvblwiXG4gICAgICAgIChjbGljayk9XCJvbkNsaWNrKClcIlxuICAgICAgPlxuICAgICAgICB7eyBhY3Rpb25UZXh0IH19XG4gICAgICA8L2J1dHRvbj5cbiAgICA8L2Rpdj5cbiAgYCxcbiAgZW5jYXBzdWxhdGlvbjogVmlld0VuY2Fwc3VsYXRpb24uTm9uZSxcbn0pXG5leHBvcnQgY2xhc3MgTWRsU25hY2tiYXJDb21wb25lbnQge1xuICBtZXNzYWdlOiBzdHJpbmc7XG4gIGFjdGlvblRleHQ6IHN0cmluZztcbiAgc2hvd0l0ID0gZmFsc2U7XG4gIG9uQWN0aW9uOiAoKSA9PiB2b2lkO1xuXG4gIG9uQ2xpY2soKTogdm9pZCB7XG4gICAgdGhpcy5vbkFjdGlvbigpO1xuICB9XG5cbiAgaXNBY3RpdmUoKTogYm9vbGVhbiB7XG4gICAgcmV0dXJuIHRoaXMuc2hvd0l0O1xuICB9XG5cbiAgc2hvdygpOiBPYnNlcnZhYmxlPHZvaWQ+IHtcbiAgICBjb25zdCByZXN1bHQ6IFN1YmplY3Q8dm9pZD4gPSBuZXcgU3ViamVjdCgpO1xuICAgIC8vIHdhaXQgdW5pdCB0aGUgZG9tIGlzIGluIHBsYWNlIC0gdGhlbiBzaG93SXQgd2lsbCBjaGFuZ2UgdGhlIGNzcyBjbGFzc1xuICAgIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgdGhpcy5zaG93SXQgPSB0cnVlO1xuICAgICAgLy8gZmlyZSBhZnRlciB0aGUgdmlldyBhbmltYXRpb24gaXMgZG9uZVxuICAgICAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICAgIHJlc3VsdC5uZXh0KCk7XG4gICAgICAgIHJlc3VsdC5jb21wbGV0ZSgpO1xuICAgICAgfSwgQU5JTUFUSU9OX1RJTUUpO1xuICAgIH0sIEFOSU1BVElPTl9USU1FKTtcblxuICAgIHJldHVybiByZXN1bHQuYXNPYnNlcnZhYmxlKCk7XG4gIH1cblxuICBoaWRlKCk6IE9ic2VydmFibGU8dm9pZD4ge1xuICAgIHRoaXMuc2hvd0l0ID0gZmFsc2U7XG5cbiAgICBjb25zdCByZXN1bHQ6IFN1YmplY3Q8dm9pZD4gPSBuZXcgU3ViamVjdCgpO1xuXG4gICAgLy8gZmlyZSBhZnRlciB0aGUgdmlldyBhbmltYXRpb24gaXMgZG9uZVxuICAgIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgcmVzdWx0Lm5leHQobnVsbCk7XG4gICAgICByZXN1bHQuY29tcGxldGUoKTtcbiAgICB9LCBBTklNQVRJT05fVElNRSk7XG5cbiAgICByZXR1cm4gcmVzdWx0LmFzT2JzZXJ2YWJsZSgpO1xuICB9XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgSU1kbFNuYWNrYmFyTWVzc2FnZSB7XG4gIG1lc3NhZ2U6IHN0cmluZztcbiAgdGltZW91dD86IG51bWJlcjtcbiAgY2xvc2VBZnRlclRpbWVvdXQ/OiBib29sZWFuO1xuICBhY3Rpb24/OiB7XG4gICAgaGFuZGxlcjogKCkgPT4gdm9pZDtcbiAgICB0ZXh0OiBzdHJpbmc7XG4gIH07XG59XG5cbkBJbmplY3RhYmxlKHtcbiAgcHJvdmlkZWRJbjogXCJyb290XCIsXG59KVxuZXhwb3J0IGNsYXNzIE1kbFNuYWNrYmFyU2VydmljZSB7XG4gIHByaXZhdGUgcmVhZG9ubHkgY0ZhY3Rvcnk6IENvbXBvbmVudEZhY3Rvcnk8TWRsU25hY2tiYXJDb21wb25lbnQ+O1xuICBwcml2YXRlIHByZXZpb3VzU25hY2s6IHtcbiAgICBjb21wb25lbnQ6IE1kbFNuYWNrYmFyQ29tcG9uZW50O1xuICAgIGNSZWY6IENvbXBvbmVudFJlZjxNZGxTbmFja2JhckNvbXBvbmVudD47XG4gIH07XG5cbiAgY29uc3RydWN0b3IoXG4gICAgcHJpdmF0ZSBjb21wb25lbnRGYWN0b3J5UmVzb2x2ZXI6IENvbXBvbmVudEZhY3RvcnlSZXNvbHZlcixcbiAgICBwcml2YXRlIGRpYWxvZ091dGxldFNlcnZpY2U6IE1kbERpYWxvZ091dGxldFNlcnZpY2VcbiAgKSB7XG4gICAgdGhpcy5jRmFjdG9yeSA9IHRoaXMuY29tcG9uZW50RmFjdG9yeVJlc29sdmVyLnJlc29sdmVDb21wb25lbnRGYWN0b3J5KFxuICAgICAgTWRsU25hY2tiYXJDb21wb25lbnRcbiAgICApO1xuICB9XG5cbiAgc2hvd1RvYXN0KFxuICAgIG1lc3NhZ2U6IHN0cmluZyxcbiAgICB0aW1lb3V0PzogbnVtYmVyXG4gICk6IE9ic2VydmFibGU8TWRsU25hY2tiYXJDb21wb25lbnQ+IHtcbiAgICByZXR1cm4gdGhpcy5zaG93U25hY2tiYXIoe1xuICAgICAgbWVzc2FnZSxcbiAgICAgIHRpbWVvdXQsXG4gICAgfSk7XG4gIH1cblxuICBzaG93U25hY2tiYXIoXG4gICAgc25hY2tiYXJNZXNzYWdlOiBJTWRsU25hY2tiYXJNZXNzYWdlXG4gICk6IE9ic2VydmFibGU8TWRsU25hY2tiYXJDb21wb25lbnQ+IHtcbiAgICBjb25zdCBvcHRUaW1lb3V0ID0gc25hY2tiYXJNZXNzYWdlLnRpbWVvdXQgfHwgMjc1MDtcbiAgICBjb25zdCBjbG9zZUFmdGVyVGltZW91dCA9ICEhc25hY2tiYXJNZXNzYWdlLmNsb3NlQWZ0ZXJUaW1lb3V0O1xuICAgIGNvbnN0IHZpZXdDb250YWluZXJSZWYgPSB0aGlzLmRpYWxvZ091dGxldFNlcnZpY2Uudmlld0NvbnRhaW5lclJlZjtcblxuICAgIGlmICghdmlld0NvbnRhaW5lclJlZikge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgICBcIllvdSBkaWQgbm90IHByb3ZpZGUgYSBWaWV3Q29udGFpbmVyUmVmLiBcIiArXG4gICAgICAgICAgXCJQbGVhc2Ugc2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9tc2VlbWFubi9hbmd1bGFyMi1tZGwvd2lraS9Ib3ctdG8tdXNlLXRoZS1NZGxEaWFsb2dTZXJ2aWNlXCJcbiAgICAgICk7XG4gICAgfVxuXG4gICAgY29uc3QgY1JlZiA9IHZpZXdDb250YWluZXJSZWYuY3JlYXRlQ29tcG9uZW50KFxuICAgICAgdGhpcy5jRmFjdG9yeSxcbiAgICAgIHZpZXdDb250YWluZXJSZWYubGVuZ3RoXG4gICAgKTtcblxuICAgIGNvbnN0IG1kbFNuYWNrYmFyQ29tcG9uZW50ID0gY1JlZi5pbnN0YW5jZSBhcyBNZGxTbmFja2JhckNvbXBvbmVudDtcbiAgICBtZGxTbmFja2JhckNvbXBvbmVudC5tZXNzYWdlID0gc25hY2tiYXJNZXNzYWdlLm1lc3NhZ2U7XG5cbiAgICBpZiAodGhpcy5wcmV2aW91c1NuYWNrKSB7XG4gICAgICBjb25zdCBwcmV2aW91c1NuYWNrID0gdGhpcy5wcmV2aW91c1NuYWNrO1xuICAgICAgY29uc3Qgc3Vic2NyaXB0aW9uID0gcHJldmlvdXNTbmFjay5jb21wb25lbnQuaGlkZSgpLnN1YnNjcmliZSgoKSA9PiB7XG4gICAgICAgIHByZXZpb3VzU25hY2suY1JlZi5kZXN0cm95KCk7XG4gICAgICAgIHN1YnNjcmlwdGlvbi51bnN1YnNjcmliZSgpO1xuICAgICAgfSk7XG4gICAgfVxuXG4gICAgdGhpcy5wcmV2aW91c1NuYWNrID0ge1xuICAgICAgY29tcG9uZW50OiBtZGxTbmFja2JhckNvbXBvbmVudCxcbiAgICAgIGNSZWYsXG4gICAgfTtcblxuICAgIGlmIChzbmFja2Jhck1lc3NhZ2UuYWN0aW9uKSB7XG4gICAgICBpZiAoY2xvc2VBZnRlclRpbWVvdXQpIHtcbiAgICAgICAgdGhpcy5oaWRlQW5kRGVzdHJveVNuYWNrKG1kbFNuYWNrYmFyQ29tcG9uZW50LCBjUmVmLCBvcHRUaW1lb3V0KTtcbiAgICAgIH1cbiAgICAgIG1kbFNuYWNrYmFyQ29tcG9uZW50LmFjdGlvblRleHQgPSBzbmFja2Jhck1lc3NhZ2UuYWN0aW9uLnRleHQ7XG4gICAgICBtZGxTbmFja2JhckNvbXBvbmVudC5vbkFjdGlvbiA9ICgpID0+IHtcbiAgICAgICAgbWRsU25hY2tiYXJDb21wb25lbnQuaGlkZSgpLnN1YnNjcmliZSgoKSA9PiB7XG4gICAgICAgICAgY1JlZi5kZXN0cm95KCk7XG4gICAgICAgICAgc25hY2tiYXJNZXNzYWdlLmFjdGlvbi5oYW5kbGVyKCk7XG4gICAgICAgIH0pO1xuICAgICAgfTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5oaWRlQW5kRGVzdHJveVNuYWNrKG1kbFNuYWNrYmFyQ29tcG9uZW50LCBjUmVmLCBvcHRUaW1lb3V0KTtcbiAgICB9XG5cbiAgICBjb25zdCByZXN1bHQ6IFN1YmplY3Q8TWRsU25hY2tiYXJDb21wb25lbnQ+ID0gbmV3IFN1YmplY3Q8TWRsU25hY2tiYXJDb21wb25lbnQ+KCk7XG5cbiAgICBtZGxTbmFja2JhckNvbXBvbmVudC5zaG93KCkuc3Vic2NyaWJlKCgpID0+IHtcbiAgICAgIHJlc3VsdC5uZXh0KG1kbFNuYWNrYmFyQ29tcG9uZW50KTtcbiAgICAgIHJlc3VsdC5jb21wbGV0ZSgpO1xuICAgIH0pO1xuXG4gICAgcmV0dXJuIHJlc3VsdC5hc09ic2VydmFibGUoKTtcbiAgfVxuXG4gIHByaXZhdGUgaGlkZUFuZERlc3Ryb3lTbmFjayhjb21wb25lbnQsIGNvbXBvbmVudFJlZiwgdGltZU91dCkge1xuICAgIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgY29tcG9uZW50LmhpZGUoKS5zdWJzY3JpYmUoKCkgPT4ge1xuICAgICAgICBjb21wb25lbnRSZWYuZGVzdHJveSgpO1xuICAgICAgfSk7XG4gICAgfSwgdGltZU91dCk7XG4gIH1cbn1cbiJdfQ==