import { Component, ElementRef, forwardRef, HostBinding, Inject, NgZone, Renderer2, ViewChild, ViewContainerRef, ViewEncapsulation, } from "@angular/core";
import { MDL_CONFIGUARTION, MIN_DIALOG_Z_INDEX } from "./config";
import { MdlButtonComponent } from "../button/mdl-button.component";
import { InternalMdlDialogReference } from "./internal-dialog-reference";
import { Animations } from "../common/animations";
const enterTransitionDuration = 300;
const leaveTransitionDuration = 250;
const enterTransitionEasingCurve = "cubic-bezier(0.0, 0.0, 0.2, 1)";
const leaveTransitionEasingCurve = "cubic-bezier(0.0, 0.0, 0.2, 1)";
const createOpenCloseRect = (rect) => ({
    height: rect.top - rect.bottom,
    left: rect.left,
    top: rect.top,
    width: rect.right - rect.left,
});
const ɵ0 = createOpenCloseRect;
const getCenterInScreen = (rect) => ({
    cx: Math.round(rect.left + rect.width / 2),
    cy: Math.round(rect.top + rect.height / 2),
});
const ɵ1 = getCenterInScreen;
const getClientRect = (input) => {
    if (input instanceof MdlButtonComponent) {
        const elRef = input.elementRef;
        const rect = elRef.nativeElement.getBoundingClientRect();
        return createOpenCloseRect(rect);
    }
    else if (input instanceof MouseEvent) {
        const evt = input;
        // just to make it possible to test this code with a fake event - target is
        // readonly and con not be mutated.
        // eslint-disable-next-line
        const htmlElement = (evt.target || evt.testtarget);
        const rect = htmlElement.getBoundingClientRect();
        return createOpenCloseRect(rect);
    }
    return input;
};
const ɵ2 = getClientRect;
// @experimental
export class MdlDialogHostComponent {
    constructor(ngZone, renderer, animations, elementRef, config, internalDialogRef) {
        this.ngZone = ngZone;
        this.renderer = renderer;
        this.animations = animations;
        this.elementRef = elementRef;
        this.config = config;
        this.internalDialogRef = internalDialogRef;
        this.isDialog = true;
        this.visible = false;
        this.zIndex = MIN_DIALOG_Z_INDEX + 1;
        this.showAnimationStartStyle = {
            top: "38%",
            opacity: "0",
        };
        this.showStyle = {
            top: "50%",
            opacity: "1",
        };
        this.hideAnimationEndStyle = {
            top: "63%",
            opacity: "0",
        };
    }
    show() {
        this.visible = true;
        // give the dialogs time to draw so that a focus can be set
        setTimeout(() => {
            this.internalDialogRef.visible();
        });
        if (this.isAnimateEnabled()) {
            if (this.config.openFrom || this.config.closeTo) {
                // transform is modified during anmiation and must be part of each animation keyframe.
                this.showStyle.transform = "translate(0, -50%) scale(1.0)";
                const targetClientRect = this.elementRef.nativeElement.getBoundingClientRect();
                const openFromRect = getClientRect(this.config.openFrom);
                const closeToRect = this.config.closeTo
                    ? getClientRect(this.config.closeTo)
                    : openFromRect;
                const centerTarget = getCenterInScreen(targetClientRect);
                const centerFrom = getCenterInScreen(openFromRect);
                const centerTo = getCenterInScreen(closeToRect);
                const translationFrom = {
                    x: Math.round(centerFrom.cx - centerTarget.cx),
                    y: Math.round(centerFrom.cy - centerTarget.cy),
                    scaleX: Math.round(100 * Math.min(0.25, openFromRect.width / targetClientRect.width)) / 100,
                    scaleY: Math.round(100 *
                        Math.min(0.25, openFromRect.height / targetClientRect.height)) / 100,
                };
                this.showAnimationStartStyle = {
                    top: `${targetClientRect.top}px`,
                    opacity: "0",
                    transform: `translate(${translationFrom.x}px, ${translationFrom.y}px) scale(${translationFrom.scaleX}, ${translationFrom.scaleY})`,
                };
                const translationTo = {
                    x: Math.round(centerTo.cx - centerTarget.cx),
                    y: Math.round(centerTo.cy - centerTarget.cy),
                    scaleX: Math.round(100 * Math.min(0.25, closeToRect.width / targetClientRect.width)) / 100,
                    scaleY: Math.round(100 * Math.min(0.25, closeToRect.height / targetClientRect.height)) / 100,
                };
                this.hideAnimationEndStyle = {
                    top: `${targetClientRect.top}px`,
                    opacity: "0",
                    transform: `translate(${translationTo.x}px, ${translationTo.y}px) scale(${translationTo.scaleX}, ${translationTo.scaleY})`,
                };
            }
            const animation = this.animations.animate(this.elementRef.nativeElement, [this.showAnimationStartStyle, this.showStyle], this.config.enterTransitionDuration || enterTransitionDuration, this.config.enterTransitionEasingCurve || enterTransitionEasingCurve);
            animation.play();
        }
    }
    hide(selfComponentRef) {
        if (this.isAnimateEnabled()) {
            const animation = this.animations.animate(this.elementRef.nativeElement, [this.showStyle, this.hideAnimationEndStyle], this.config.leaveTransitionDuration || leaveTransitionDuration, this.config.leaveTransitionEasingCurve || leaveTransitionEasingCurve);
            animation.onDone(() => {
                selfComponentRef.destroy();
            });
            animation.play();
        }
        else {
            selfComponentRef.destroy();
        }
    }
    ngOnInit() {
        this.applyStyle(this.config.styles);
        this.applyClasses(this.config.classes ? this.config.classes : "");
    }
    applyStyle(styles) {
        if (styles) {
            for (const style of Object.keys(styles)) {
                this.renderer.setStyle(this.elementRef.nativeElement, style, styles[style]);
            }
        }
    }
    applyClasses(classes) {
        classes
            .split(" ")
            .filter((cssClass) => !!cssClass)
            .forEach((cssClass) => {
            this.renderer.addClass(this.elementRef.nativeElement, cssClass);
        });
    }
    isAnimateEnabled() {
        // not present?  assume it is true.
        if (typeof this.config.animate === "undefined") {
            return true;
        }
        return this.config.animate;
    }
}
MdlDialogHostComponent.decorators = [
    { type: Component, args: [{
                selector: "mdl-dialog-host-component",
                template: ` <div #dialogTarget></div>`,
                encapsulation: ViewEncapsulation.None,
                styles: [`
      mdl-dialog-host-component {
        width: fit-content;
        height: fit-content;
        padding: 1em;
        background: white;
        color: black;
        opacity: 1;
        visibility: hidden;
        display: block;
        position: fixed;
        margin: auto;
        left: 0;
        right: 0;
        transition: all;
        top: 50%;
        transform: translate(0, -50%);
      }

      mdl-dialog-host-component.open {
        visibility: visible;
      }
    `]
            },] }
];
MdlDialogHostComponent.ctorParameters = () => [
    { type: NgZone },
    { type: Renderer2 },
    { type: Animations },
    { type: ElementRef },
    { type: undefined, decorators: [{ type: Inject, args: [forwardRef(() => MDL_CONFIGUARTION),] }] },
    { type: InternalMdlDialogReference }
];
MdlDialogHostComponent.propDecorators = {
    dialogTarget: [{ type: ViewChild, args: ["dialogTarget", { read: ViewContainerRef, static: true },] }],
    isDialog: [{ type: HostBinding, args: ["class.mdl-dialog",] }],
    visible: [{ type: HostBinding, args: ["class.open",] }],
    zIndex: [{ type: HostBinding, args: ["style.zIndex",] }]
};
export { ɵ0, ɵ1, ɵ2 };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibWRsLWRpYWxvZy1ob3N0LmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uLy4uL3Byb2plY3RzL2NvcmUvc3JjL2xpYi9kaWFsb2cvbWRsLWRpYWxvZy1ob3N0LmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQ0wsU0FBUyxFQUVULFVBQVUsRUFDVixVQUFVLEVBQ1YsV0FBVyxFQUNYLE1BQU0sRUFDTixNQUFNLEVBRU4sU0FBUyxFQUNULFNBQVMsRUFDVCxnQkFBZ0IsRUFDaEIsaUJBQWlCLEdBQ2xCLE1BQU0sZUFBZSxDQUFDO0FBRXZCLE9BQU8sRUFBRSxpQkFBaUIsRUFBRSxrQkFBa0IsRUFBRSxNQUFNLFVBQVUsQ0FBQztBQUtqRSxPQUFPLEVBQUUsa0JBQWtCLEVBQUUsTUFBTSxnQ0FBZ0MsQ0FBQztBQUNwRSxPQUFPLEVBQUUsMEJBQTBCLEVBQUUsTUFBTSw2QkFBNkIsQ0FBQztBQUN6RSxPQUFPLEVBQUUsVUFBVSxFQUFFLE1BQU0sc0JBQXNCLENBQUM7QUFFbEQsTUFBTSx1QkFBdUIsR0FBRyxHQUFHLENBQUM7QUFDcEMsTUFBTSx1QkFBdUIsR0FBRyxHQUFHLENBQUM7QUFFcEMsTUFBTSwwQkFBMEIsR0FBRyxnQ0FBZ0MsQ0FBQztBQUNwRSxNQUFNLDBCQUEwQixHQUFHLGdDQUFnQyxDQUFDO0FBRXBFLE1BQU0sbUJBQW1CLEdBQUcsQ0FBQyxJQUFnQixFQUFrQixFQUFFLENBQUMsQ0FBQztJQUNqRSxNQUFNLEVBQUUsSUFBSSxDQUFDLEdBQUcsR0FBRyxJQUFJLENBQUMsTUFBTTtJQUM5QixJQUFJLEVBQUUsSUFBSSxDQUFDLElBQUk7SUFDZixHQUFHLEVBQUUsSUFBSSxDQUFDLEdBQUc7SUFDYixLQUFLLEVBQUUsSUFBSSxDQUFDLEtBQUssR0FBRyxJQUFJLENBQUMsSUFBSTtDQUM5QixDQUFDLENBQUM7O0FBRUgsTUFBTSxpQkFBaUIsR0FBRyxDQUFD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ZW50IjpbImltcG9ydCB7XG4gIENvbXBvbmVudCxcbiAgQ29tcG9uZW50UmVmLFxuICBFbGVtZW50UmVmLFxuICBmb3J3YXJkUmVmLFxuICBIb3N0QmluZGluZyxcbiAgSW5qZWN0LFxuICBOZ1pvbmUsXG4gIE9uSW5pdCxcbiAgUmVuZGVyZXIyLFxuICBWaWV3Q2hpbGQsXG4gIFZpZXdDb250YWluZXJSZWYsXG4gIFZpZXdFbmNhcHN1bGF0aW9uLFxufSBmcm9tIFwiQGFuZ3VsYXIvY29yZVwiO1xuXG5pbXBvcnQgeyBNRExfQ09ORklHVUFSVElPTiwgTUlOX0RJQUxPR19aX0lOREVYIH0gZnJvbSBcIi4vY29uZmlnXCI7XG5pbXBvcnQge1xuICBJTWRsRGlhbG9nQ29uZmlndXJhdGlvbixcbiAgSU9wZW5DbG9zZVJlY3QsXG59IGZyb20gXCIuL21kbC1kaWFsb2ctY29uZmlndXJhdGlvblwiO1xuaW1wb3J0IHsgTWRsQnV0dG9uQ29tcG9uZW50IH0gZnJvbSBcIi4uL2J1dHRvbi9tZGwtYnV0dG9uLmNvbXBvbmVudFwiO1xuaW1wb3J0IHsgSW50ZXJuYWxNZGxEaWFsb2dSZWZlcmVuY2UgfSBmcm9tIFwiLi9pbnRlcm5hbC1kaWFsb2ctcmVmZXJlbmNlXCI7XG5pbXBvcnQgeyBBbmltYXRpb25zIH0gZnJvbSBcIi4uL2NvbW1vbi9hbmltYXRpb25zXCI7XG5cbmNvbnN0IGVudGVyVHJhbnNpdGlvbkR1cmF0aW9uID0gMzAwO1xuY29uc3QgbGVhdmVUcmFuc2l0aW9uRHVyYXRpb24gPSAyNTA7XG5cbmNvbnN0IGVudGVyVHJhbnNpdGlvbkVhc2luZ0N1cnZlID0gXCJjdWJpYy1iZXppZXIoMC4wLCAwLjAsIDAuMiwgMSlcIjtcbmNvbnN0IGxlYXZlVHJhbnNpdGlvbkVhc2luZ0N1cnZlID0gXCJjdWJpYy1iZXppZXIoMC4wLCAwLjAsIDAuMiwgMSlcIjtcblxuY29uc3QgY3JlYXRlT3BlbkNsb3NlUmVjdCA9IChyZWN0OiBDbGllbnRSZWN0KTogSU9wZW5DbG9zZVJlY3QgPT4gKHtcbiAgaGVpZ2h0OiByZWN0LnRvcCAtIHJlY3QuYm90dG9tLFxuICBsZWZ0OiByZWN0LmxlZnQsXG4gIHRvcDogcmVjdC50b3AsXG4gIHdpZHRoOiByZWN0LnJpZ2h0IC0gcmVjdC5sZWZ0LFxufSk7XG5cbmNvbnN0IGdldENlbnRlckluU2NyZWVuID0gKHJlY3Q6IElPcGVuQ2xvc2VSZWN0KSA9PiAoe1xuICBjeDogTWF0aC5yb3VuZChyZWN0LmxlZnQgKyByZWN0LndpZHRoIC8gMiksXG4gIGN5OiBNYXRoLnJvdW5kKHJlY3QudG9wICsgcmVjdC5oZWlnaHQgLyAyKSxcbn0pO1xuXG5jb25zdCBnZXRDbGllbnRSZWN0ID0gKFxuICBpbnB1dDogTWRsQnV0dG9uQ29tcG9uZW50IHwgTW91c2VFdmVudCB8IElPcGVuQ2xvc2VSZWN0XG4pOiBJT3BlbkNsb3NlUmVjdCA9PiB7XG4gIGlmIChpbnB1dCBpbnN0YW5jZW9mIE1kbEJ1dHRvbkNvbXBvbmVudCkge1xuICAgIGNvbnN0IGVsUmVmID0gKGlucHV0IGFzIE1kbEJ1dHRvbkNvbXBvbmVudCkuZWxlbWVudFJlZjtcbiAgICBjb25zdCByZWN0OiBDbGllbnRSZWN0ID0gZWxSZWYubmF0aXZlRWxlbWVudC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTtcbiAgICByZXR1cm4gY3JlYXRlT3BlbkNsb3NlUmVjdChyZWN0KTtcbiAgfSBlbHNlIGlmIChpbnB1dCBpbnN0YW5jZW9mIE1vdXNlRXZlbnQpIHtcbiAgICBjb25zdCBldnQ6IE1vdXNlRXZlbnQgPSBpbnB1dCBhcyBNb3VzZUV2ZW50O1xuICAgIC8vIGp1c3QgdG8gbWFrZSBpdCBwb3NzaWJsZSB0byB0ZXN0IHRoaXMgY29kZSB3aXRoIGEgZmFrZSBldmVudCAtIHRhcmdldCBpc1xuICAgIC8vIHJlYWRvbmx5IGFuZCBjb24gbm90IGJlIG11dGF0ZWQuXG4gICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lXG4gICAgY29uc3QgaHRtbEVsZW1lbnQgPSAoZXZ0LnRhcmdldCB8fCAoZXZ0IGFzIGFueSkudGVzdHRhcmdldCkgYXMgSFRNTEVsZW1lbnQ7XG4gICAgY29uc3QgcmVjdDogQ2xpZW50UmVjdCA9IGh0bWxFbGVtZW50LmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpO1xuICAgIHJldHVybiBjcmVhdGVPcGVuQ2xvc2VSZWN0KHJlY3QpO1xuICB9XG4gIHJldHVybiBpbnB1dCBhcyBJT3BlbkNsb3NlUmVjdDtcbn07XG5cbi8vIEBleHBlcmltZW50YWxcbkBDb21wb25lbnQoe1xuICBzZWxlY3RvcjogXCJtZGwtZGlhbG9nLWhvc3QtY29tcG9uZW50XCIsXG4gIHRlbXBsYXRlOiBgIDxkaXYgI2RpYWxvZ1RhcmdldD48L2Rpdj5gLFxuICBzdHlsZXM6IFtcbiAgICBgXG4gICAgICBtZGwtZGlhbG9nLWhvc3QtY29tcG9uZW50IHtcbiAgICAgICAgd2lkdGg6IGZpdC1jb250ZW50O1xuICAgICAgICBoZWlnaHQ6IGZpdC1jb250ZW50O1xuICAgICAgICBwYWRkaW5nOiAxZW07XG4gICAgICAgIGJhY2tncm91bmQ6IHdoaXRlO1xuICAgICAgICBjb2xvcjogYmxhY2s7XG4gICAgICAgIG9wYWNpdHk6IDE7XG4gICAgICAgIHZpc2liaWxpdHk6IGhpZGRlbjtcbiAgICAgICAgZGlzcGxheTogYmxvY2s7XG4gICAgICAgIHBvc2l0aW9uOiBmaXhlZDtcbiAgICAgICAgbWFyZ2luOiBhdXRvO1xuICAgICAgICBsZWZ0OiAwO1xuICAgICAgICByaWdodDogMDtcbiAgICAgICAgdHJhbnNpdGlvbjogYWxsO1xuICAgICAgICB0b3A6IDUwJTtcbiAgICAgICAgdHJhbnNmb3JtOiB0cmFuc2xhdGUoMCwgLTUwJSk7XG4gICAgICB9XG5cbiAgICAgIG1kbC1kaWFsb2ctaG9zdC1jb21wb25lbnQub3BlbiB7XG4gICAgICAgIHZpc2liaWxpdHk6IHZpc2libGU7XG4gICAgICB9XG4gICAgYCxcbiAgXSxcbiAgZW5jYXBzdWxhdGlvbjogVmlld0VuY2Fwc3VsYXRpb24uTm9uZSxcbn0pXG5leHBvcnQgY2xhc3MgTWRsRGlhbG9nSG9zdENvbXBvbmVudCBpbXBsZW1lbnRzIE9uSW5pdCB7XG4gIEBWaWV3Q2hpbGQoXCJkaWFsb2dUYXJnZXRcIiwgeyByZWFkOiBWaWV3Q29udGFpbmVyUmVmLCBzdGF0aWM6IHRydWUgfSlcbiAgZGlhbG9nVGFyZ2V0OiBWaWV3Q29udGFpbmVyUmVmO1xuXG4gIEBIb3N0QmluZGluZyhcImNsYXNzLm1kbC1kaWFsb2dcIilcbiAgaXNEaWFsb2cgPSB0cnVlO1xuXG4gIEBIb3N0QmluZGluZyhcImNsYXNzLm9wZW5cIilcbiAgdmlzaWJsZSA9IGZhbHNlO1xuXG4gIEBIb3N0QmluZGluZyhcInN0eWxlLnpJbmRleFwiKVxuICB6SW5kZXg6IG51bWJlciA9IE1JTl9ESUFMT0dfWl9JTkRFWCArIDE7XG5cbiAgcHJpdmF0ZSBzaG93QW5pbWF0aW9uU3RhcnRTdHlsZTogeyBba2V5OiBzdHJpbmddOiBzdHJpbmcgfSA9IHtcbiAgICB0b3A6IFwiMzglXCIsXG4gICAgb3BhY2l0eTogXCIwXCIsXG4gIH07XG4gIHByaXZhdGUgc2hvd1N0eWxlOiB7IFtrZXk6IHN0cmluZ106IHN0cmluZyB9ID0ge1xuICAgIHRvcDogXCI1MCVcIixcbiAgICBvcGFjaXR5OiBcIjFcIixcbiAgfTtcbiAgcHJpdmF0ZSBoaWRlQW5pbWF0aW9uRW5kU3R5bGU6IHsgW2tleTogc3RyaW5nXTogc3RyaW5nIH0gPSB7XG4gICAgdG9wOiBcIjYzJVwiLFxuICAgIG9wYWNpdHk6IFwiMFwiLFxuICB9O1xuXG4gIGNvbnN0cnVjdG9yKFxuICAgIHByaXZhdGUgbmdab25lOiBOZ1pvbmUsXG4gICAgcHJpdmF0ZSByZW5kZXJlcjogUmVuZGVyZXIyLFxuICAgIHByaXZhdGUgYW5pbWF0aW9uczogQW5pbWF0aW9ucyxcbiAgICBwcml2YXRlIGVsZW1lbnRSZWY6IEVsZW1lbnRSZWYsXG4gICAgQEluamVjdChmb3J3YXJkUmVmKCgpID0+IE1ETF9DT05GSUdVQVJUSU9OKSlcbiAgICBwcml2YXRlIGNvbmZpZzogSU1kbERpYWxvZ0NvbmZpZ3VyYXRpb24sXG4gICAgcHJpdmF0ZSBpbnRlcm5hbERpYWxvZ1JlZjogSW50ZXJuYWxNZGxEaWFsb2dSZWZlcmVuY2VcbiAgKSB7fVxuXG4gIHNob3coKTogdm9pZCB7XG4gICAgdGhpcy52aXNpYmxlID0gdHJ1ZTtcbiAgICAvLyBnaXZlIHRoZSBkaWFsb2dzIHRpbWUgdG8gZHJhdyBzbyB0aGF0IGEgZm9jdXMgY2FuIGJlIHNldFxuICAgIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgdGhpcy5pbnRlcm5hbERpYWxvZ1JlZi52aXNpYmxlKCk7XG4gICAgfSk7XG5cbiAgICBpZiAodGhpcy5pc0FuaW1hdGVFbmFibGVkKCkpIHtcbiAgICAgIGlmICh0aGlzLmNvbmZpZy5vcGVuRnJvbSB8fCB0aGlzLmNvbmZpZy5jbG9zZVRvKSB7XG4gICAgICAgIC8vIHRyYW5zZm9ybSBpcyBtb2RpZmllZCBkdXJpbmcgYW5taWF0aW9uIGFuZCBtdXN0IGJlIHBhcnQgb2YgZWFjaCBhbmltYXRpb24ga2V5ZnJhbWUuXG4gICAgICAgIHRoaXMuc2hvd1N0eWxlLnRyYW5zZm9ybSA9IFwidHJhbnNsYXRlKDAsIC01MCUpIHNjYWxlKDEuMClcIjtcblxuICAgICAgICBjb25zdCB0YXJnZXRDbGllbnRSZWN0ID0gdGhpcy5lbGVtZW50UmVmLm5hdGl2ZUVsZW1lbnQuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7XG5cbiAgICAgICAgY29uc3Qgb3BlbkZyb21SZWN0ID0gZ2V0Q2xpZW50UmVjdCh0aGlzLmNvbmZpZy5vcGVuRnJvbSk7XG4gICAgICAgIGNvbnN0IGNsb3NlVG9SZWN0ID0gdGhpcy5jb25maWcuY2xvc2VUb1xuICAgICAgICAgID8gZ2V0Q2xpZW50UmVjdCh0aGlzLmNvbmZpZy5jbG9zZVRvKVxuICAgICAgICAgIDogb3BlbkZyb21SZWN0O1xuXG4gICAgICAgIGNvbnN0IGNlbnRlclRhcmdldCA9IGdldENlbnRlckluU2NyZWVuKHRhcmdldENsaWVudFJlY3QpO1xuICAgICAgICBjb25zdCBjZW50ZXJGcm9tID0gZ2V0Q2VudGVySW5TY3JlZW4ob3BlbkZyb21SZWN0KTtcbiAgICAgICAgY29uc3QgY2VudGVyVG8gPSBnZXRDZW50ZXJJblNjcmVlbihjbG9zZVRvUmVjdCk7XG5cbiAgICAgICAgY29uc3QgdHJhbnNsYXRpb25Gcm9tID0ge1xuICAgICAgICAgIHg6IE1hdGgucm91bmQoY2VudGVyRnJvbS5jeCAtIGNlbnRlclRhcmdldC5jeCksXG4gICAgICAgICAgeTogTWF0aC5yb3VuZChjZW50ZXJGcm9tLmN5IC0gY2VudGVyVGFyZ2V0LmN5KSxcbiAgICAgICAgICBzY2FsZVg6XG4gICAgICAgICAgICBNYXRoLnJvdW5kKFxuICAgICAgICAgICAgICAxMDAgKiBNYXRoLm1pbigwLjI1LCBvcGVuRnJvbVJlY3Qud2lkdGggLyB0YXJnZXRDbGllbnRSZWN0LndpZHRoKVxuICAgICAgICAgICAgKSAvIDEwMCxcbiAgICAgICAgICBzY2FsZVk6XG4gICAgICAgICAgICBNYXRoLnJvdW5kKFxuICAgICAgICAgICAgICAxMDAgKlxuICAgICAgICAgICAgICAgIE1hdGgubWluKDAuMjUsIG9wZW5Gcm9tUmVjdC5oZWlnaHQgLyB0YXJnZXRDbGllbnRSZWN0LmhlaWdodClcbiAgICAgICAgICAgICkgLyAxMDAsXG4gICAgICAgIH07XG5cbiAgICAgICAgdGhpcy5zaG93QW5pbWF0aW9uU3RhcnRTdHlsZSA9IHtcbiAgICAgICAgICB0b3A6IGAke3RhcmdldENsaWVudFJlY3QudG9wfXB4YCxcbiAgICAgICAgICBvcGFjaXR5OiBcIjBcIixcbiAgICAgICAgICB0cmFuc2Zvcm06IGB0cmFuc2xhdGUoJHt0cmFuc2xhdGlvbkZyb20ueH1weCwgJHt0cmFuc2xhdGlvbkZyb20ueX1weCkgc2NhbGUoJHt0cmFuc2xhdGlvbkZyb20uc2NhbGVYfSwgJHt0cmFuc2xhdGlvbkZyb20uc2NhbGVZfSlgLFxuICAgICAgICB9O1xuXG4gICAgICAgIGNvbnN0IHRyYW5zbGF0aW9uVG8gPSB7XG4gICAgICAgICAgeDogTWF0aC5yb3VuZChjZW50ZXJUby5jeCAtIGNlbnRlclRhcmdldC5jeCksXG4gICAgICAgICAgeTogTWF0aC5yb3VuZChjZW50ZXJUby5jeSAtIGNlbnRlclRhcmdldC5jeSksXG4gICAgICAgICAgc2NhbGVYOlxuICAgICAgICAgICAgTWF0aC5yb3VuZChcbiAgICAgICAgICAgICAgMTAwICogTWF0aC5taW4oMC4yNSwgY2xvc2VUb1JlY3Qud2lkdGggLyB0YXJnZXRDbGllbnRSZWN0LndpZHRoKVxuICAgICAgICAgICAgKSAvIDEwMCxcbiAgICAgICAgICBzY2FsZVk6XG4gICAgICAgICAgICBNYXRoLnJvdW5kKFxuICAgICAgICAgICAgICAxMDAgKiBNYXRoLm1pbigwLjI1LCBjbG9zZVRvUmVjdC5oZWlnaHQgLyB0YXJnZXRDbGllbnRSZWN0LmhlaWdodClcbiAgICAgICAgICAgICkgLyAxMDAsXG4gICAgICAgIH07XG5cbiAgICAgICAgdGhpcy5oaWRlQW5pbWF0aW9uRW5kU3R5bGUgPSB7XG4gICAgICAgICAgdG9wOiBgJHt0YXJnZXRDbGllbnRSZWN0LnRvcH1weGAsXG4gICAgICAgICAgb3BhY2l0eTogXCIwXCIsXG4gICAgICAgICAgdHJhbnNmb3JtOiBgdHJhbnNsYXRlKCR7dHJhbnNsYXRpb25Uby54fXB4LCAke3RyYW5zbGF0aW9uVG8ueX1weCkgc2NhbGUoJHt0cmFuc2xhdGlvblRvLnNjYWxlWH0sICR7dHJhbnNsYXRpb25Uby5zY2FsZVl9KWAsXG4gICAgICAgIH07XG4gICAgICB9XG5cbiAgICAgIGNvbnN0IGFuaW1hdGlvbiA9IHRoaXMuYW5pbWF0aW9ucy5hbmltYXRlKFxuICAgICAgICB0aGlzLmVsZW1lbnRSZWYubmF0aXZlRWxlbWVudCxcbiAgICAgICAgW3RoaXMuc2hvd0FuaW1hdGlvblN0YXJ0U3R5bGUsIHRoaXMuc2hvd1N0eWxlXSxcbiAgICAgICAgdGhpcy5jb25maWcuZW50ZXJUcmFuc2l0aW9uRHVyYXRpb24gfHwgZW50ZXJUcmFuc2l0aW9uRHVyYXRpb24sXG4gICAgICAgIHRoaXMuY29uZmlnLmVudGVyVHJhbnNpdGlvbkVhc2luZ0N1cnZlIHx8IGVudGVyVHJhbnNpdGlvbkVhc2luZ0N1cnZlXG4gICAgICApO1xuXG4gICAgICBhbmltYXRpb24ucGxheSgpO1xuICAgIH1cbiAgfVxuXG4gIGhpZGUoc2VsZkNvbXBvbmVudFJlZjogQ29tcG9uZW50UmVmPE1kbERpYWxvZ0hvc3RDb21wb25lbnQ+KTogdm9pZCB7XG4gICAgaWYgKHRoaXMuaXNBbmltYXRlRW5hYmxlZCgpKSB7XG4gICAgICBjb25zdCBhbmltYXRpb24gPSB0aGlzLmFuaW1hdGlvbnMuYW5pbWF0ZShcbiAgICAgICAgdGhpcy5lbGVtZW50UmVmLm5hdGl2ZUVsZW1lbnQsXG4gICAgICAgIFt0aGlzLnNob3dTdHlsZSwgdGhpcy5oaWRlQW5pbWF0aW9uRW5kU3R5bGVdLFxuICAgICAgICB0aGlzLmNvbmZpZy5sZWF2ZVRyYW5zaXRpb25EdXJhdGlvbiB8fCBsZWF2ZVRyYW5zaXRpb25EdXJhdGlvbixcbiAgICAgICAgdGhpcy5jb25maWcubGVhdmVUcmFuc2l0aW9uRWFzaW5nQ3VydmUgfHwgbGVhdmVUcmFuc2l0aW9uRWFzaW5nQ3VydmVcbiAgICAgICk7XG5cbiAgICAgIGFuaW1hdGlvbi5vbkRvbmUoKCkgPT4ge1xuICAgICAgICBzZWxmQ29tcG9uZW50UmVmLmRlc3Ryb3koKTtcbiAgICAgIH0pO1xuXG4gICAgICBhbmltYXRpb24ucGxheSgpO1xuICAgIH0gZWxzZSB7XG4gICAgICBzZWxmQ29tcG9uZW50UmVmLmRlc3Ryb3koKTtcbiAgICB9XG4gIH1cblxuICBuZ09uSW5pdCgpOiB2b2lkIHtcbiAgICB0aGlzLmFwcGx5U3R5bGUodGhpcy5jb25maWcuc3R5bGVzKTtcbiAgICB0aGlzLmFwcGx5Q2xhc3Nlcyh0aGlzLmNvbmZpZy5jbGFzc2VzID8gdGhpcy5jb25maWcuY2xhc3NlcyA6IFwiXCIpO1xuICB9XG5cbiAgcHJpdmF0ZSBhcHBseVN0eWxlKHN0eWxlczogeyBba2V5OiBzdHJpbmddOiBzdHJpbmcgfSkge1xuICAgIGlmIChzdHlsZXMpIHtcbiAgICAgIGZvciAoY29uc3Qgc3R5bGUgb2YgT2JqZWN0LmtleXMoc3R5bGVzKSkge1xuICAgICAgICB0aGlzLnJlbmRlcmVyLnNldFN0eWxlKFxuICAgICAgICAgIHRoaXMuZWxlbWVudFJlZi5uYXRpdmVFbGVtZW50LFxuICAgICAgICAgIHN0eWxlLFxuICAgICAgICAgIHN0eWxlc1tzdHlsZV1cbiAgICAgICAgKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICBwcml2YXRlIGFwcGx5Q2xhc3NlcyhjbGFzc2VzOiBzdHJpbmcpIHtcbiAgICBjbGFzc2VzXG4gICAgICAuc3BsaXQoXCIgXCIpXG4gICAgICAuZmlsdGVyKChjc3NDbGFzcykgPT4gISFjc3NDbGFzcylcbiAgICAgIC5mb3JFYWNoKChjc3NDbGFzcykgPT4ge1xuICAgICAgICB0aGlzLnJlbmRlcmVyLmFkZENsYXNzKHRoaXMuZWxlbWVudFJlZi5uYXRpdmVFbGVtZW50LCBjc3NDbGFzcyk7XG4gICAgICB9KTtcbiAgfVxuXG4gIHByaXZhdGUgaXNBbmltYXRlRW5hYmxlZCgpIHtcbiAgICAvLyBub3QgcHJlc2VudD8gIGFzc3VtZSBpdCBpcyB0cnVlLlxuICAgIGlmICh0eXBlb2YgdGhpcy5jb25maWcuYW5pbWF0ZSA9PT0gXCJ1bmRlZmluZWRcIikge1xuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuICAgIHJldHVybiB0aGlzLmNvbmZpZy5hbmltYXRlO1xuICB9XG59XG4iXX0=