import { Component, ElementRef, EventEmitter, forwardRef, HostBinding, HostListener, Injectable, Input, Optional, Output, Renderer2, ViewEncapsulation, } from "@angular/core";
import { FormGroupName, NG_VALUE_ACCESSOR, } from "@angular/forms";
import { toBoolean } from "../common/boolean-property";
import { noop } from "../common/noop";
import * as i0 from "@angular/core";
const throwNameError = () => {
    throw new Error(`
      If you define both a name and a formControlName attribute on your radio button, their values
      must match. Ex: <mdl-radio formControlName="food" name="food"></mdl-radio>
    `);
};
const ɵ0 = throwNameError;
const IS_FOCUSED = "is-focused";
// Registry for mdl-readio compnents. Is responsible to keep the
// right state of the radio buttons of a radio group. It would be
// easier if i had a mdl-radio-group component. but this would be
// a big braking change.
export class MdlRadioGroupRegisty {
    constructor() {
        this.defaultFormGroup = "defaultFromGroup";
        this.radioComponents = [];
    }
    add(radioComponent, formGroupName) {
        this.radioComponents.push({
            radio: radioComponent,
            group: formGroupName || this.defaultFormGroup,
        });
    }
    remove(radioComponent) {
        this.radioComponents = this.radioComponents.filter((radioComponentInArray) => radioComponentInArray.radio !== radioComponent);
    }
    select(radioComponent, formGroupName) {
        // unselect every radioComponent that is not the provided radiocomponent
        // and has the same name and is in teh same group.
        const groupToTest = formGroupName || this.defaultFormGroup;
        this.radioComponents.forEach((component) => {
            if (component.radio.name === radioComponent.name &&
                component.group === groupToTest) {
                if (component.radio !== radioComponent) {
                    component.radio.deselect(radioComponent.value);
                }
            }
        });
    }
}
MdlRadioGroupRegisty.ɵprov = i0.ɵɵdefineInjectable({ factory: function MdlRadioGroupRegisty_Factory() { return new MdlRadioGroupRegisty(); }, token: MdlRadioGroupRegisty, providedIn: "root" });
MdlRadioGroupRegisty.decorators = [
    { type: Injectable, args: [{
                providedIn: "root",
            },] }
];
/*
 <mdl-radio name="group1" value="1" [(ngModel)]="radioOption">Value 1</mdl-radio>
 */
export class MdlRadioComponent {
    constructor(elementRef, renderer, radioGroupRegistry, formGroupName) {
        this.elementRef = elementRef;
        this.renderer = renderer;
        this.radioGroupRegistry = radioGroupRegistry;
        this.formGroupName = formGroupName;
        this.tabindex = null;
        // eslint-disable-next-line
        this.change = new EventEmitter();
        // the internal state - used to set the underlaying radio button state.
        this.checked = false;
        this.isUpgraded = true;
        this.isRadio = true;
        this.onTouchedCallback = noop;
        this.onChangeCallback = noop;
        this.disabledIntern = false;
        this.el = elementRef.nativeElement;
    }
    get disabled() {
        return this.disabledIntern;
    }
    set disabled(value) {
        this.disabledIntern = toBoolean(value);
    }
    onClick() {
        if (this.disabled) {
            return;
        }
        this.optionValue = this.value;
        this.updateCheckState();
        this.onChangeCallback();
        this.change.emit(this.optionValue);
    }
    ngOnInit() {
        // we need a name and it must be the same as in the formcontrol.
        // a radio group without name is useless.
        this.checkName();
        // register the radio button - this is the only chance to unselect the
        // radio button that is no longer active - scope the radio button with it's group
        // if there is one.
        this.radioGroupRegistry.add(this, this.formGroupName);
    }
    ngOnDestroy() {
        this.radioGroupRegistry.remove(this);
    }
    writeValue(optionValue) {
        this.optionValue = optionValue;
        this.updateCheckState();
    }
    deselect(value) {
        // called from the registry. the value is the value of the selected radio button
        // e.g. the radio button get unselected if it isnÄt the selected one.
        this.writeValue(value);
    }
    registerOnChange(fn) {
        // wrap the callback, so that we can call select on the registry
        this.onChangeCallback = () => {
            fn(this.value);
            this.radioGroupRegistry.select(this, this.formGroupName);
        };
    }
    registerOnTouched(fn) {
        this.onTouchedCallback = fn;
    }
    setDisabledState(isDisabled) {
        this.disabled = isDisabled;
    }
    onFocus() {
        this.renderer.addClass(this.el, IS_FOCUSED);
    }
    onBlur() {
        this.renderer.removeClass(this.el, IS_FOCUSED);
    }
    spaceKeyPress() {
        this.checked = false; // in case of space key is pressed radio button value must remain same
    }
    updateCheckState() {
        this.checked = this.optionValue === this.value;
    }
    checkName() {
        if (this.name &&
            this.formControlName &&
            this.name !== this.formControlName) {
            throwNameError();
        }
        if (!this.name && this.formControlName) {
            this.name = this.formControlName;
        }
    }
}
MdlRadioComponent.decorators = [
    { type: Component, args: [{
                selector: "mdl-radio",
                providers: [
                    {
                        provide: NG_VALUE_ACCESSOR,
                        useExisting: forwardRef(() => MdlRadioComponent),
                        multi: true,
                    },
                ],
                template: `
    <input
      type="checkbox"
      class="mdl-radio__button"
      [attr.name]="name"
      (focus)="onFocus()"
      (blur)="onBlur()"
      (keyup.space)="spaceKeyPress()"
      [disabled]="disabled"
      [attr.tabindex]="tabindex"
      [(ngModel)]="checked"
    />
    <span class="mdl-radio__label"><ng-content></ng-content></span>
    <span class="mdl-radio__outer-circle"></span>
    <span class="mdl-radio__inner-circle"></span>
  `,
                encapsulation: ViewEncapsulation.None
            },] }
];
MdlRadioComponent.ctorParameters = () => [
    { type: ElementRef },
    { type: Renderer2 },
    { type: MdlRadioGroupRegisty },
    { type: FormGroupName, decorators: [{ type: Optional }] }
];
MdlRadioComponent.propDecorators = {
    name: [{ type: Input }],
    formControlName: [{ type: Input }],
    value: [{ type: Input }],
    tabindex: [{ type: Input }],
    change: [{ type: Output }],
    checked: [{ type: HostBinding, args: ["class.is-checked",] }],
    isUpgraded: [{ type: HostBinding, args: ["class.is-upgraded",] }],
    isRadio: [{ type: HostBinding, args: ["class.mdl-radio",] }],
    disabled: [{ type: HostBinding, args: ["class.is-disabled",] }, { type: Input }],
    onClick: [{ type: HostListener, args: ["click",] }]
};
export { ɵ0 };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibWRsLXJhZGlvLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uLy4uL3Byb2plY3RzL2NvcmUvc3JjL2xpYi9yYWRpby9tZGwtcmFkaW8uY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFDTCxTQUFTLEVBQ1QsVUFBVSxFQUNWLFlBQVksRUFDWixVQUFVLEVBQ1YsV0FBVyxFQUNYLFlBQVksRUFDWixVQUFVLEVBQ1YsS0FBSyxFQUdMLFFBQVEsRUFDUixNQUFNLEVBQ04sU0FBUyxFQUNULGlCQUFpQixHQUNsQixNQUFNLGVBQWUsQ0FBQztBQUN2QixPQUFPLEVBRUwsYUFBYSxFQUNiLGlCQUFpQixHQUNsQixNQUFNLGdCQUFnQixDQUFDO0FBQ3hCLE9BQU8sRUFBRSxTQUFTLEVBQUUsTUFBTSw0QkFBNEIsQ0FBQztBQUN2RCxPQUFPLEVBQUUsSUFBSSxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7O0FBRXRDLE1BQU0sY0FBYyxHQUFHLEdBQVMsRUFBRTtJQUNoQyxNQUFNLElBQUksS0FBSyxDQUFDOzs7S0FHYixDQUFDLENBQUM7QUFDUCxDQUFDLENBQUM7O0FBRUYsTUFBTSxVQUFVLEdBQUcsWUFBWSxDQUFDO0FBRWhDLGdFQUFnRTtBQUNoRSxpRUFBaUU7QUFDakUsaUVBQWlFO0FBQ2pFLHdCQUF3QjtBQUl4QixNQUFNLE9BQU8sb0JBQW9CO0lBSGpDO1FBSVUscUJBQWdCLEdBQUcsa0JBQWtCLENBQUM7UUFDdEMsb0JBQWUsR0FHakIsRUFBRSxDQUFDO0tBaUNWO0lBL0JDLEdBQUcsQ0FBQyxjQUFpQyxFQUFFLGFBQTRCO1FBQ2pFLElBQUksQ0FBQyxlQUFlLENBQUMsSUFBSSxDQUFDO1lBQ3hCLEtBQUssRUFBRSxjQUFjO1lBQ3JCLEtBQUssRUFBRSxhQUFhLElBQUksSUFBSSxDQUFDLGdCQUFnQjtTQUM5QyxDQUFDLENBQUM7SUFDTCxDQUFDO0lBRUQsTUFBTSxDQUFD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SUFBSSxDQUFDLElBQUksS0FBSyxJQUFJLENBQUMsZUFBZSxFQUNsQztZQUNBLGNBQWMsRUFBRSxDQUFDO1NBQ2xCO1FBQ0QsSUFBSSxDQUFDLElBQUksQ0FBQyxJQUFJLElBQUksSUFBSSxDQUFDLGVBQWUsRUFBRTtZQUN0QyxJQUFJLENBQUMsSUFBSSxHQUFHLElBQUksQ0FBQyxlQUFlLENBQUM7U0FDbEM7SUFDSCxDQUFDOzs7WUF2SkYsU0FBUyxTQUFDO2dCQUNULFFBQVEsRUFBRSxXQUFXO2dCQUNyQixTQUFTLEVBQUU7b0JBQ1Q7d0JBQ0UsT0FBTyxFQUFFLGlCQUFpQjt3QkFDMUIsV0FBVyxFQUFFLFVBQVUsQ0FBQyxHQUFHLEVBQUUsQ0FBQyxpQkFBaUIsQ0FBQzt3QkFDaEQsS0FBSyxFQUFFLElBQUk7cUJBQ1o7aUJBQ0Y7Z0JBQ0QsUUFBUSxFQUFFOzs7Ozs7Ozs7Ozs7Ozs7R0FlVDtnQkFDRCxhQUFhLEVBQUUsaUJBQWlCLENBQUMsSUFBSTthQUN0Qzs7O1lBNUdDLFVBQVU7WUFXVixTQUFTO1lBK0hxQixvQkFBb0I7WUExSGxELGFBQWEsdUJBMkhWLFFBQVE7OzttQkE1QlYsS0FBSzs4QkFFTCxLQUFLO29CQUVMLEtBQUs7dUJBRUwsS0FBSztxQkFHTCxNQUFNO3NCQUdOLFdBQVcsU0FBQyxrQkFBa0I7eUJBRTlCLFdBQVcsU0FBQyxtQkFBbUI7c0JBQy9CLFdBQVcsU0FBQyxpQkFBaUI7dUJBa0I3QixXQUFXLFNBQUMsbUJBQW1CLGNBQy9CLEtBQUs7c0JBU0wsWUFBWSxTQUFDLE9BQU8iLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge1xuICBDb21wb25lbnQsXG4gIEVsZW1lbnRSZWYsXG4gIEV2ZW50RW1pdHRlcixcbiAgZm9yd2FyZFJlZixcbiAgSG9zdEJpbmRpbmcsXG4gIEhvc3RMaXN0ZW5lcixcbiAgSW5qZWN0YWJsZSxcbiAgSW5wdXQsXG4gIE9uRGVzdHJveSxcbiAgT25Jbml0LFxuICBPcHRpb25hbCxcbiAgT3V0cHV0LFxuICBSZW5kZXJlcjIsXG4gIFZpZXdFbmNhcHN1bGF0aW9uLFxufSBmcm9tIFwiQGFuZ3VsYXIvY29yZVwiO1xuaW1wb3J0IHtcbiAgQ29udHJvbFZhbHVlQWNjZXNzb3IsXG4gIEZvcm1Hcm91cE5hbWUsXG4gIE5HX1ZBTFVFX0FDQ0VTU09SLFxufSBmcm9tIFwiQGFuZ3VsYXIvZm9ybXNcIjtcbmltcG9ydCB7IHRvQm9vbGVhbiB9IGZyb20gXCIuLi9jb21tb24vYm9vbGVhbi1wcm9wZXJ0eVwiO1xuaW1wb3J0IHsgbm9vcCB9IGZyb20gXCIuLi9jb21tb24vbm9vcFwiO1xuXG5jb25zdCB0aHJvd05hbWVFcnJvciA9ICgpOiB2b2lkID0+IHtcbiAgdGhyb3cgbmV3IEVycm9yKGBcbiAgICAgIElmIHlvdSBkZWZpbmUgYm90aCBhIG5hbWUgYW5kIGEgZm9ybUNvbnRyb2xOYW1lIGF0dHJpYnV0ZSBvbiB5b3VyIHJhZGlvIGJ1dHRvbiwgdGhlaXIgdmFsdWVzXG4gICAgICBtdXN0IG1hdGNoLiBFeDogPG1kbC1yYWRpbyBmb3JtQ29udHJvbE5hbWU9XCJmb29kXCIgbmFtZT1cImZvb2RcIj48L21kbC1yYWRpbz5cbiAgICBgKTtcbn07XG5cbmNvbnN0IElTX0ZPQ1VTRUQgPSBcImlzLWZvY3VzZWRcIjtcblxuLy8gUmVnaXN0cnkgZm9yIG1kbC1yZWFkaW8gY29tcG5lbnRzLiBJcyByZXNwb25zaWJsZSB0byBrZWVwIHRoZVxuLy8gcmlnaHQgc3RhdGUgb2YgdGhlIHJhZGlvIGJ1dHRvbnMgb2YgYSByYWRpbyBncm91cC4gSXQgd291bGQgYmVcbi8vIGVhc2llciBpZiBpIGhhZCBhIG1kbC1yYWRpby1ncm91cCBjb21wb25lbnQuIGJ1dCB0aGlzIHdvdWxkIGJlXG4vLyBhIGJpZyBicmFraW5nIGNoYW5nZS5cbkBJbmplY3RhYmxlKHtcbiAgcHJvdmlkZWRJbjogXCJyb290XCIsXG59KVxuZXhwb3J0IGNsYXNzIE1kbFJhZGlvR3JvdXBSZWdpc3R5IHtcbiAgcHJpdmF0ZSBkZWZhdWx0Rm9ybUdyb3VwID0gXCJkZWZhdWx0RnJvbUdyb3VwXCI7XG4gIHByaXZhdGUgcmFkaW9Db21wb25lbnRzOiB7XG4gICAgcmFkaW86IE1kbFJhZGlvQ29tcG9uZW50O1xuICAgIGdyb3VwOiBGb3JtR3JvdXBOYW1lIHwgc3RyaW5nO1xuICB9W10gPSBbXTtcblxuICBhZGQocmFkaW9Db21wb25lbnQ6IE1kbFJhZGlvQ29tcG9uZW50LCBmb3JtR3JvdXBOYW1lOiBGb3JtR3JvdXBOYW1lKTogdm9pZCB7XG4gICAgdGhpcy5yYWRpb0NvbXBvbmVudHMucHVzaCh7XG4gICAgICByYWRpbzogcmFkaW9Db21wb25lbnQsXG4gICAgICBncm91cDogZm9ybUdyb3VwTmFtZSB8fCB0aGlzLmRlZmF1bHRGb3JtR3JvdXAsXG4gICAgfSk7XG4gIH1cblxuICByZW1vdmUocmFkaW9Db21wb25lbnQ6IE1kbFJhZGlvQ29tcG9uZW50KTogdm9pZCB7XG4gICAgdGhpcy5yYWRpb0NvbXBvbmVudHMgPSB0aGlzLnJhZGlvQ29tcG9uZW50cy5maWx0ZXIoXG4gICAgICAocmFkaW9Db21wb25lbnRJbkFycmF5KSA9PiByYWRpb0NvbXBvbmVudEluQXJyYXkucmFkaW8gIT09IHJhZGlvQ29tcG9uZW50XG4gICAgKTtcbiAgfVxuXG4gIHNlbGVjdChcbiAgICByYWRpb0NvbXBvbmVudDogTWRsUmFkaW9Db21wb25lbnQsXG4gICAgZm9ybUdyb3VwTmFtZTogRm9ybUdyb3VwTmFtZVxuICApOiB2b2lkIHtcbiAgICAvLyB1bnNlbGVjdCBldmVyeSByYWRpb0NvbXBvbmVudCB0aGF0IGlzIG5vdCB0aGUgcHJvdmlkZWQgcmFkaW9jb21wb25lbnRcbiAgICAvLyBhbmQgaGFzIHRoZSBzYW1lIG5hbWUgYW5kIGlzIGluIHRlaCBzYW1lIGdyb3VwLlxuICAgIGNvbnN0IGdyb3VwVG9UZXN0ID0gZm9ybUdyb3VwTmFtZSB8fCB0aGlzLmRlZmF1bHRGb3JtR3JvdXA7XG4gICAgdGhpcy5yYWRpb0NvbXBvbmVudHMuZm9yRWFjaCgoY29tcG9uZW50KSA9PiB7XG4gICAgICBpZiAoXG4gICAgICAgIGNvbXBvbmVudC5yYWRpby5uYW1lID09PSByYWRpb0NvbXBvbmVudC5uYW1lICYmXG4gICAgICAgIGNvbXBvbmVudC5ncm91cCA9PT0gZ3JvdXBUb1Rlc3RcbiAgICAgICkge1xuICAgICAgICBpZiAoY29tcG9uZW50LnJhZGlvICE9PSByYWRpb0NvbXBvbmVudCkge1xuICAgICAgICAgIGNvbXBvbmVudC5yYWRpby5kZXNlbGVjdChyYWRpb0NvbXBvbmVudC52YWx1ZSk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9KTtcbiAgfVxufVxuXG4vKlxuIDxtZGwtcmFkaW8gbmFtZT1cImdyb3VwMVwiIHZhbHVlPVwiMVwiIFsobmdNb2RlbCldPVwicmFkaW9PcHRpb25cIj5WYWx1ZSAxPC9tZGwtcmFkaW8+XG4gKi9cblxuQENvbXBvbmVudCh7XG4gIHNlbGVjdG9yOiBcIm1kbC1yYWRpb1wiLFxuICBwcm92aWRlcnM6IFtcbiAgICB7XG4gICAgICBwcm92aWRlOiBOR19WQUxVRV9BQ0NFU1NPUixcbiAgICAgIHVzZUV4aXN0aW5nOiBmb3J3YXJkUmVmKCgpID0+IE1kbFJhZGlvQ29tcG9uZW50KSxcbiAgICAgIG11bHRpOiB0cnVlLFxuICAgIH0sXG4gIF0sXG4gIHRlbXBsYXRlOiBgXG4gICAgPGlucHV0XG4gICAgICB0eXBlPVwiY2hlY2tib3hcIlxuICAgICAgY2xhc3M9XCJtZGwtcmFkaW9fX2J1dHRvblwiXG4gICAgICBbYXR0ci5uYW1lXT1cIm5hbWVcIlxuICAgICAgKGZvY3VzKT1cIm9uRm9jdXMoKVwiXG4gICAgICAoYmx1cik9XCJvbkJsdXIoKVwiXG4gICAgICAoa2V5dXAuc3BhY2UpPVwic3BhY2VLZXlQcmVzcygpXCJcbiAgICAgIFtkaXNhYmxlZF09XCJkaXNhYmxlZFwiXG4gICAgICBbYXR0ci50YWJpbmRleF09XCJ0YWJpbmRleFwiXG4gICAgICBbKG5nTW9kZWwpXT1cImNoZWNrZWRcIlxuICAgIC8+XG4gICAgPHNwYW4gY2xhc3M9XCJtZGwtcmFkaW9fX2xhYmVsXCI+PG5nLWNvbnRlbnQ+PC9uZy1jb250ZW50Pjwvc3Bhbj5cbiAgICA8c3BhbiBjbGFzcz1cIm1kbC1yYWRpb19fb3V0ZXItY2lyY2xlXCI+PC9zcGFuPlxuICAgIDxzcGFuIGNsYXNzPVwibWRsLXJhZGlvX19pbm5lci1jaXJjbGVcIj48L3NwYW4+XG4gIGAsXG4gIGVuY2Fwc3VsYXRpb246IFZpZXdFbmNhcHN1bGF0aW9uLk5vbmUsXG59KVxuZXhwb3J0IGNsYXNzIE1kbFJhZGlvQ29tcG9uZW50XG4gIGltcGxlbWVudHMgQ29udHJvbFZhbHVlQWNjZXNzb3IsIE9uSW5pdCwgT25EZXN0cm95IHtcbiAgQElucHV0KClcbiAgbmFtZTogc3RyaW5nO1xuICBASW5wdXQoKVxuICBmb3JtQ29udHJvbE5hbWU6IHN0cmluZztcbiAgQElucHV0KClcbiAgdmFsdWU6IHVua25vd247XG4gIEBJbnB1dCgpXG4gIHRhYmluZGV4ID0gbnVsbDtcbiAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lXG4gIEBPdXRwdXQoKVxuICBjaGFuZ2U6IEV2ZW50RW1pdHRlcjx1bmtub3duPiA9IG5ldyBFdmVudEVtaXR0ZXI8dW5rbm93bj4oKTtcbiAgLy8gdGhlIGludGVybmFsIHN0YXRlIC0gdXNlZCB0byBzZXQgdGhlIHVuZGVybGF5aW5nIHJhZGlvIGJ1dHRvbiBzdGF0ZS5cbiAgQEhvc3RCaW5kaW5nKFwiY2xhc3MuaXMtY2hlY2tlZFwiKVxuICBjaGVja2VkID0gZmFsc2U7XG4gIEBIb3N0QmluZGluZyhcImNsYXNzLmlzLXVwZ3JhZGVkXCIpIGlzVXBncmFkZWQgPSB0cnVlO1xuICBASG9zdEJpbmRpbmcoXCJjbGFzcy5tZGwtcmFkaW9cIikgaXNSYWRpbyA9IHRydWU7XG5cbiAgcHVibGljIG9wdGlvblZhbHVlOiB1bmtub3duO1xuXG4gIHByaXZhdGUgcmVhZG9ubHkgZWw6IEhUTUxFbGVtZW50O1xuICBwcml2YXRlIG9uVG91Y2hlZENhbGxiYWNrOiAoKSA9PiB2b2lkID0gbm9vcDtcbiAgcHJpdmF0ZSBvbkNoYW5nZUNhbGxiYWNrOiAoKSA9PiB2b2lkID0gbm9vcDtcbiAgcHJpdmF0ZSBkaXNhYmxlZEludGVybiA9IGZhbHNlO1xuXG4gIGNvbnN0cnVjdG9yKFxuICAgIHByaXZhdGUgZWxlbWVudFJlZjogRWxlbWVudFJlZixcbiAgICBwcml2YXRlIHJlbmRlcmVyOiBSZW5kZXJlcjIsXG4gICAgcHJpdmF0ZSByYWRpb0dyb3VwUmVnaXN0cnk6IE1kbFJhZGlvR3JvdXBSZWdpc3R5LFxuICAgIEBPcHRpb25hbCgpIHByaXZhdGUgZm9ybUdyb3VwTmFtZTogRm9ybUdyb3VwTmFtZVxuICApIHtcbiAgICB0aGlzLmVsID0gZWxlbWVudFJlZi5uYXRpdmVFbGVtZW50O1xuICB9XG5cbiAgQEhvc3RCaW5kaW5nKFwiY2xhc3MuaXMtZGlzYWJsZWRcIilcbiAgQElucHV0KClcbiAgZ2V0IGRpc2FibGVkKCk6IGJvb2xlYW4ge1xuICAgIHJldHVybiB0aGlzLmRpc2FibGVkSW50ZXJuO1xuICB9XG5cbiAgc2V0IGRpc2FibGVkKHZhbHVlOiBib29sZWFuKSB7XG4gICAgdGhpcy5kaXNhYmxlZEludGVybiA9IHRvQm9vbGVhbih2YWx1ZSk7XG4gIH1cblxuICBASG9zdExpc3RlbmVyKFwiY2xpY2tcIilcbiAgb25DbGljaygpOiB2b2lkIHtcbiAgICBpZiAodGhpcy5kaXNhYmxlZCkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICB0aGlzLm9wdGlvblZhbHVlID0gdGhpcy52YWx1ZTtcbiAgICB0aGlzLnVwZGF0ZUNoZWNrU3RhdGUoKTtcbiAgICB0aGlzLm9uQ2hhbmdlQ2FsbGJhY2soKTtcbiAgICB0aGlzLmNoYW5nZS5lbWl0KHRoaXMub3B0aW9uVmFsdWUpO1xuICB9XG5cbiAgbmdPbkluaXQoKTogdm9pZCB7XG4gICAgLy8gd2UgbmVlZCBhIG5hbWUgYW5kIGl0IG11c3QgYmUgdGhlIHNhbWUgYXMgaW4gdGhlIGZvcm1jb250cm9sLlxuICAgIC8vIGEgcmFkaW8gZ3JvdXAgd2l0aG91dCBuYW1lIGlzIHVzZWxlc3MuXG4gICAgdGhpcy5jaGVja05hbWUoKTtcbiAgICAvLyByZWdpc3RlciB0aGUgcmFkaW8gYnV0dG9uIC0gdGhpcyBpcyB0aGUgb25seSBjaGFuY2UgdG8gdW5zZWxlY3QgdGhlXG4gICAgLy8gcmFkaW8gYnV0dG9uIHRoYXQgaXMgbm8gbG9uZ2VyIGFjdGl2ZSAtIHNjb3BlIHRoZSByYWRpbyBidXR0b24gd2l0aCBpdCdzIGdyb3VwXG4gICAgLy8gaWYgdGhlcmUgaXMgb25lLlxuICAgIHRoaXMucmFkaW9Hcm91cFJlZ2lzdHJ5LmFkZCh0aGlzLCB0aGlzLmZvcm1Hcm91cE5hbWUpO1xuICB9XG5cbiAgbmdPbkRlc3Ryb3koKTogdm9pZCB7XG4gICAgdGhpcy5yYWRpb0dyb3VwUmVnaXN0cnkucmVtb3ZlKHRoaXMpO1xuICB9XG5cbiAgd3JpdGVWYWx1ZShvcHRpb25WYWx1ZTogdW5rbm93bik6IHZvaWQge1xuICAgIHRoaXMub3B0aW9uVmFsdWUgPSBvcHRpb25WYWx1ZTtcbiAgICB0aGlzLnVwZGF0ZUNoZWNrU3RhdGUoKTtcbiAgfVxuXG4gIGRlc2VsZWN0KHZhbHVlOiB1bmtub3duKTogdm9pZCB7XG4gICAgLy8gY2FsbGVkIGZyb20gdGhlIHJlZ2lzdHJ5LiB0aGUgdmFsdWUgaXMgdGhlIHZhbHVlIG9mIHRoZSBzZWxlY3RlZCByYWRpbyBidXR0b25cbiAgICAvLyBlLmcuIHRoZSByYWRpbyBidXR0b24gZ2V0IHVuc2VsZWN0ZWQgaWYgaXQgaXNuw4R0IHRoZSBzZWxlY3RlZCBvbmUuXG4gICAgdGhpcy53cml0ZVZhbHVlKHZhbHVlKTtcbiAgfVxuXG4gIHJlZ2lzdGVyT25DaGFuZ2UoZm46ICh2OiB1bmtub3duKSA9PiB1bmtub3duKTogdm9pZCB7XG4gICAgLy8gd3JhcCB0aGUgY2FsbGJhY2ssIHNvIHRoYXQgd2UgY2FuIGNhbGwgc2VsZWN0IG9uIHRoZSByZWdpc3RyeVxuICAgIHRoaXMub25DaGFuZ2VDYWxsYmFjayA9ICgpID0+IHtcbiAgICAgIGZuKHRoaXMudmFsdWUpO1xuICAgICAgdGhpcy5yYWRpb0dyb3VwUmVnaXN0cnkuc2VsZWN0KHRoaXMsIHRoaXMuZm9ybUdyb3VwTmFtZSk7XG4gICAgfTtcbiAgfVxuXG4gIHJlZ2lzdGVyT25Ub3VjaGVkKGZuOiAoKSA9PiB1bmtub3duKTogdm9pZCB7XG4gICAgdGhpcy5vblRvdWNoZWRDYWxsYmFjayA9IGZuO1xuICB9XG5cbiAgc2V0RGlzYWJsZWRTdGF0ZShpc0Rpc2FibGVkOiBib29sZWFuKTogdm9pZCB7XG4gICAgdGhpcy5kaXNhYmxlZCA9IGlzRGlzYWJsZWQ7XG4gIH1cblxuICBvbkZvY3VzKCk6IHZvaWQge1xuICAgIHRoaXMucmVuZGVyZXIuYWRkQ2xhc3ModGhpcy5lbCwgSVNfRk9DVVNFRCk7XG4gIH1cblxuICBvbkJsdXIoKTogdm9pZCB7XG4gICAgdGhpcy5yZW5kZXJlci5yZW1vdmVDbGFzcyh0aGlzLmVsLCBJU19GT0NVU0VEKTtcbiAgfVxuXG4gIHNwYWNlS2V5UHJlc3MoKTogdm9pZCB7XG4gICAgdGhpcy5jaGVja2VkID0gZmFsc2U7IC8vIGluIGNhc2Ugb2Ygc3BhY2Uga2V5IGlzIHByZXNzZWQgcmFkaW8gYnV0dG9uIHZhbHVlIG11c3QgcmVtYWluIHNhbWVcbiAgfVxuXG4gIHByaXZhdGUgdXBkYXRlQ2hlY2tTdGF0ZSgpIHtcbiAgICB0aGlzLmNoZWNrZWQgPSB0aGlzLm9wdGlvblZhbHVlID09PSB0aGlzLnZhbHVlO1xuICB9XG5cbiAgcHJpdmF0ZSBjaGVja05hbWUoKTogdm9pZCB7XG4gICAgaWYgKFxuICAgICAgdGhpcy5uYW1lICYmXG4gICAgICB0aGlzLmZvcm1Db250cm9sTmFtZSAmJlxuICAgICAgdGhpcy5uYW1lICE9PSB0aGlzLmZvcm1Db250cm9sTmFtZVxuICAgICkge1xuICAgICAgdGhyb3dOYW1lRXJyb3IoKTtcbiAgICB9XG4gICAgaWYgKCF0aGlzLm5hbWUgJiYgdGhpcy5mb3JtQ29udHJvbE5hbWUpIHtcbiAgICAgIHRoaXMubmFtZSA9IHRoaXMuZm9ybUNvbnRyb2xOYW1lO1xuICAgIH1cbiAgfVxufVxuIl19