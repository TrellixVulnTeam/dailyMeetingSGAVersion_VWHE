import { Component, ContentChild, ContentChildren, ElementRef, EventEmitter, Inject, Injectable, InjectionToken, Input, NgZone, Optional, Output, QueryList, Renderer2, ViewEncapsulation, } from "@angular/core";
import { EventManager } from "@angular/platform-browser";
import { MdlLayoutHeaderComponent } from "./mdl-layout-header.component";
import { MdlLayoutDrawerComponent } from "./mdl-layout-drawer.component";
import { MdlLayoutContentComponent } from "./mdl-layout-content.component";
import { BehaviorSubject } from "rxjs";
import { toBoolean } from "../common/boolean-property";
import { toNumber } from "../common/number.property";
import { MdlError } from "../common/mdl-error";
import { MdlLayoutMediatorService } from "./mdl-layout-mediator.service";
import * as i0 from "@angular/core";
const ESCAPE = 27;
const STANDARD = "standard";
const WATERFALL = "waterfall";
const SCROLL = "scroll";
/**
 * The LAYOUT_SCREEN_SIZE_THRESHOLD can be changed at the root module. Just provide a value for this InjectionToken:
 *
 * providers: [
 *  {provide:LAYOUT_SCREEN_SIZE_THRESHOLD, useValue: 768 }
 * ]
 *
 * you also need to change the scss variable to the same value: $layout-screen-size-threshold: 768px.
 *
 * It should be clear that this can only be used if you are using the scss and not the pre compiled css from getmdl.io.
 *
 */
export const LAYOUT_SCREEN_SIZE_THRESHOLD = new InjectionToken("layoutScreenSizeThreshold");
export class MdLUnsupportedLayoutTypeError extends MdlError {
    constructor(type) {
        /* istanbul ignore next */
        super(`Layout type "${type}" isn't supported by mdl-layout (allowed: standard, waterfall, scroll).`);
    }
}
export class MdlScreenSizeService {
    constructor(ngZone, layoutScreenSizeThreshold) {
        this.layoutScreenSizeThreshold = layoutScreenSizeThreshold;
        this.sizesSubject = new BehaviorSubject(false);
        // if no value is injected the default size wil be used. same as $layout-screen-size-threshold in scss
        if (!this.layoutScreenSizeThreshold) {
            this.layoutScreenSizeThreshold = 1024;
        }
        // do not try to access the window object if rendered on the server
        if (typeof window === "object" && "matchMedia" in window) {
            const query = window.matchMedia(`(max-width: ${this.layoutScreenSizeThreshold}px)`);
            const queryListener = () => {
                ngZone.run(() => {
                    this.sizesSubject.next(query.matches);
                });
            };
            // - addEventListener not working in Safari
            // eslint-disable-next-line
            query.addListener(queryListener);
            this.windowMediaQueryListener = () => {
                // eslint-disable-next-line
                query.removeListener(queryListener);
            };
            // set the initial state
            this.sizesSubject.next(query.matches);
        }
    }
    isSmallScreen() {
        return this.sizesSubject.value;
    }
    sizes() {
        return this.sizesSubject.asObservable();
    }
    destroy() {
        if (this.windowMediaQueryListener) {
            this.windowMediaQueryListener();
            this.windowMediaQueryListener = null;
        }
    }
}
MdlScreenSizeService.ɵprov = i0.ɵɵdefineInjectable({ factory: function MdlScreenSizeService_Factory() { return new MdlScreenSizeService(i0.ɵɵinject(i0.NgZone), i0.ɵɵinject(LAYOUT_SCREEN_SIZE_THRESHOLD, 8)); }, token: MdlScreenSizeService, providedIn: "root" });
MdlScreenSizeService.decorators = [
    { type: Injectable, args: [{
                providedIn: "root",
            },] }
];
MdlScreenSizeService.ctorParameters = () => [
    { type: NgZone },
    { type: Number, decorators: [{ type: Optional }, { type: Inject, args: [LAYOUT_SCREEN_SIZE_THRESHOLD,] }] }
];
export class MdlLayoutComponent {
    constructor(renderer, evm, el, screenSizeService, layoutMediatorService) {
        this.renderer = renderer;
        this.evm = evm;
        this.el = el;
        this.screenSizeService = screenSizeService;
        this.layoutMediatorService = layoutMediatorService;
        // eslint-disable-next-line
        this.mode = STANDARD;
        // eslint-disable-next-line
        this.selectedTabEmitter = new EventEmitter();
        // eslint-disable-next-line
        this.mouseoverTabEmitter = new EventEmitter();
        // eslint-disable-next-line
        this.mouseoutTabEmitter = new EventEmitter();
        // eslint-disable-next-line
        this.onOpen = new EventEmitter();
        // eslint-disable-next-line
        this.onClose = new EventEmitter();
        this.isDrawerVisible = false;
        this.isSmallScreen = false;
        this.isFixedDrawerIntern = false;
        this.isFixedHeaderIntern = false;
        this.isSeamedIntern = false;
        this.selectedIndexIntern = 0;
        this.isNoDrawerIntern = false;
        this.subscriptions = [];
    }
    get isFixedDrawer() {
        return this.isFixedDrawerIntern;
    }
    set isFixedDrawer(value) {
        this.isFixedDrawerIntern = toBoolean(value);
    }
    get isFixedHeader() {
        return this.isFixedHeaderIntern;
    }
    set isFixedHeader(value) {
        this.isFixedHeaderIntern = toBoolean(value);
    }
    get isSeamed() {
        return this.isSeamedIntern;
    }
    set isSeamed(value) {
        this.isSeamedIntern = toBoolean(value);
    }
    get selectedIndex() {
        return this.selectedIndexIntern;
    }
    set selectedIndex(value) {
        this.selectedIndexIntern = toNumber(value);
    }
    get isNoDrawer() {
        return this.isNoDrawerIntern;
    }
    set isNoDrawer(value) {
        this.isNoDrawerIntern = toBoolean(value);
    }
    ngAfterContentInit() {
        this.validateMode();
        if (this.header && this.content && this.content.tabs) {
            this.header.tabs = this.content.tabs;
            this.updateSelectedTabIndex();
        }
        if (this.header && this.header.tabs) {
            this.subscriptions.push(this.layoutMediatorService
                .onTabMouseOut()
                .subscribe((tab) => {
                this.onTabMouseout(tab);
            }));
            this.subscriptions.push(this.layoutMediatorService
                .onTabMouseover()
                .subscribe((tab) => {
                this.onTabMouseover(tab);
            }));
            this.subscriptions.push(this.layoutMediatorService
                .onTabSelected()
                .subscribe((tab) => {
                this.tabSelected(tab);
            }));
        }
    }
    ngOnChanges(changes) {
        if (changes.selectedIndex) {
            this.updateSelectedTabIndex();
        }
    }
    toggleDrawer() {
        this.isDrawerVisible = !this.isDrawerVisible;
        if (this.drawers.length > 0) {
            this.setDrawerVisible(this.isDrawerVisible);
        }
    }
    closeDrawer() {
        this.isDrawerVisible = false;
        if (this.drawers.length > 0) {
            this.setDrawerVisible(false);
        }
    }
    openDrawer() {
        this.isDrawerVisible = true;
        if (this.drawers.length > 0) {
            this.setDrawerVisible(true);
        }
    }
    obfuscatorKeyDown($event) {
        if ($event.keyCode === ESCAPE) {
            this.toggleDrawer();
        }
    }
    ngOnDestroy() {
        if (this.scrollListener) {
            this.scrollListener();
            this.scrollListener = null;
        }
        this.subscriptions.forEach((sub) => sub.unsubscribe());
    }
    closeDrawerOnSmallScreens() {
        if (this.isSmallScreen && this.isDrawerVisible) {
            this.closeDrawer();
        }
    }
    openDrawerOnSmallScreens() {
        if (this.isSmallScreen && !this.isDrawerVisible) {
            this.openDrawer();
        }
    }
    hasDrawer() {
        return this.drawers.length > 0;
    }
    tabSelected(tab) {
        const index = this.header.tabs.toArray().indexOf(tab);
        if (index !== this.selectedIndex) {
            this.selectedIndex = index;
            this.updateSelectedTabIndex();
            this.selectedTabEmitter.emit({ index: this.selectedIndex });
        }
    }
    onTabMouseover(tab) {
        const index = this.header.tabs.toArray().indexOf(tab);
        this.mouseoverTabEmitter.emit({ index });
    }
    onTabMouseout(tab) {
        const index = this.header.tabs.toArray().indexOf(tab);
        this.mouseoutTabEmitter.emit({ index });
    }
    updateSelectedTabIndex() {
        if (this.header && this.header.tabs) {
            this.header.tabs.forEach((tab) => (tab.isActive = false));
            if (this.header.tabs.toArray().length > 0 &&
                this.selectedIndex < this.header.tabs.toArray().length) {
                this.header.tabs.toArray()[this.selectedIndex].isActive = true;
            }
        }
    }
    validateMode() {
        if (this.mode === "") {
            this.mode = STANDARD;
        }
        if ([STANDARD, WATERFALL, SCROLL].indexOf(this.mode) === -1) {
            throw new MdLUnsupportedLayoutTypeError(this.mode);
        }
        if (this.header) {
            // inform the header about the mode
            this.header.mode = this.mode;
            this.header.isSeamed = this.isSeamed;
        }
        if (this.content) {
            this.scrollListener = this.renderer.listen(this.content.el, "scroll", () => {
                this.onScroll(this.content.el.scrollTop);
                return true;
            });
            this.screenSizeService.sizes().subscribe((isSmall) => {
                this.onQueryChange(isSmall);
            });
        }
    }
    onScroll(scrollTop) {
        if (this.mode !== WATERFALL) {
            return;
        }
        if (this.header.isAnimating) {
            return;
        }
        const headerVisible = !this.isSmallScreen || this.isFixedHeader;
        if (scrollTop > 0 && !this.header.isCompact) {
            this.header.isCompact = true;
            if (headerVisible) {
                this.header.isAnimating = true;
            }
        }
        else if (scrollTop <= 0 && this.header.isCompact) {
            this.header.isCompact = false;
            if (headerVisible) {
                this.header.isAnimating = true;
            }
        }
    }
    onQueryChange(isSmall) {
        if (isSmall) {
            this.isSmallScreen = true;
        }
        else {
            this.isSmallScreen = false;
            this.closeDrawer();
        }
    }
    setDrawerVisible(visible) {
        this.drawers.first.isDrawerVisible = visible;
        if (this.drawers.first.isDrawerVisible) {
            this.onOpen.emit();
        }
        else {
            this.onClose.emit();
        }
    }
}
MdlLayoutComponent.decorators = [
    { type: Component, args: [{
                selector: "mdl-layout",
                template: `
    <div
      class="mdl-layout__container"
      [ngClass]="{ 'has-scrolling-header': mode === 'scroll' }"
    >
      <div
        class="mdl-layout is-upgraded"
        [ngClass]="{
          'is-small-screen': isSmallScreen,
          'mdl-layout--fixed-drawer': isFixedDrawer,
          'mdl-layout--fixed-header': isFixedHeader,
          'mdl-layout--fixed-tabs': 'tabs.toArray().length > 0'
        }"
      >
        <ng-content select="mdl-layout-header"></ng-content>
        <ng-content select="mdl-layout-drawer"></ng-content>
        <div
          *ngIf="drawers.length > 0 && isNoDrawer == false"
          class="mdl-layout__drawer-button"
          (click)="toggleDrawer()"
        >
          <mdl-icon>&#xE5D2;</mdl-icon>
        </div>
        <ng-content select="mdl-layout-content"></ng-content>
        <div
          class="mdl-layout__obfuscator"
          [ngClass]="{ 'is-visible': isDrawerVisible }"
          (click)="toggleDrawer()"
          (keydown)="obfuscatorKeyDown($event)"
        ></div>
      </div>
    </div>
  `,
                exportAs: "mdlLayout",
                encapsulation: ViewEncapsulation.None
            },] }
];
MdlLayoutComponent.ctorParameters = () => [
    { type: Renderer2 },
    { type: EventManager },
    { type: ElementRef },
    { type: MdlScreenSizeService },
    { type: MdlLayoutMediatorService }
];
MdlLayoutComponent.propDecorators = {
    header: [{ type: ContentChild, args: [MdlLayoutHeaderComponent,] }],
    drawers: [{ type: ContentChildren, args: [MdlLayoutDrawerComponent, { descendants: false },] }],
    content: [{ type: ContentChild, args: [MdlLayoutContentComponent, { static: true },] }],
    mode: [{ type: Input, args: ['mdl-layout-mode',] }],
    selectedTabEmitter: [{ type: Output, args: ['mdl-layout-tab-active-changed',] }],
    mouseoverTabEmitter: [{ type: Output, args: ['mdl-layout-tab-mouseover',] }],
    mouseoutTabEmitter: [{ type: Output, args: ['mdl-layout-tab-mouseout',] }],
    onOpen: [{ type: Output, args: ['open',] }],
    onClose: [{ type: Output, args: ['close',] }],
    isFixedDrawer: [{ type: Input, args: ["mdl-layout-fixed-drawer",] }],
    isFixedHeader: [{ type: Input, args: ["mdl-layout-fixed-header",] }],
    isSeamed: [{ type: Input, args: ["mdl-layout-header-seamed",] }],
    selectedIndex: [{ type: Input, args: ["mdl-layout-tab-active-index",] }],
    isNoDrawer: [{ type: Input, args: ["mdl-layout-no-drawer-button",] }]
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibWRsLWxheW91dC5jb21wb25lbnQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi8uLi9wcm9qZWN0cy9jb3JlL3NyYy9saWIvbGF5b3V0L21kbC1sYXlvdXQuY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFFTCxTQUFTLEVBQ1QsWUFBWSxFQUNaLGVBQWUsRUFDZixVQUFVLEVBQ1YsWUFBWSxFQUNaLE1BQU0sRUFDTixVQUFVLEVBQ1YsY0FBYyxFQUNkLEtBQUssRUFDTCxNQUFNLEVBR04sUUFBUSxFQUNSLE1BQU0sRUFDTixTQUFTLEVBQ1QsU0FBUyxFQUVULGlCQUFpQixHQUNsQixNQUFNLGVBQWUsQ0FBQztBQUN2QixPQUFPLEVBQUUsWUFBWSxFQUFFLE1BQU0sMkJBQTJCLENBQUM7QUFDekQsT0FBTyxFQUFFLHdCQUF3QixFQUFFLE1BQU0sK0JBQStCLENBQUM7QUFDekUsT0FBTyxFQUFFLHdCQUF3QixFQUFFLE1BQU0sK0JBQStCLENBQUM7QUFDekUsT0FBTyxFQUFFLHlCQUF5QixFQUFFLE1BQU0sZ0NBQWdDLENBQUM7QUFDM0UsT0FBTyxFQUFFLGVBQWUsRUFBNEIsTUFBTSxNQUFNLENBQUM7QUFDakUsT0FBTyxFQUFFLFNBQVMsRUFBRSxNQUFNLDRCQUE0QixDQUFDO0FBQ3ZELE9BQU8sRUFBRSxRQUFRLEVBQUUsTUFBTSwyQkFBMkIsQ0FBQztBQUNyRCxPQUFPLEVBQUUsUUFBUSxFQUFFLE1BQU0scUJBQXFCLENBQUM7QUFDL0MsT0FBTyxFQUFFLHdCQUF3QixFQUFFLE1BQU0sK0JBQStCLENBQUM7O0FBR3pFLE1BQU0sTUFBTSxHQUFHLEVBQUUsQ0FBQztBQUVsQixNQUFNLFFBQVEsR0FBRyxVQUFVLENBQUM7QUFDNUIsTUFBTSxTQUFTLEdBQUcsV0FBVyxDQUFDO0FBQzlCLE1BQU0sTUFBTSxHQUFHLFFBQVEsQ0FBQztBQUV4Qjs7Ozs7Ozs7Ozs7R0FXRztBQUNILE1B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QVcsRUFBRSxLQUFLLEVBQUU7c0JBRWhFLFlBQVksU0FBQyx5QkFBeUIsRUFBRSxFQUFFLE1BQU0sRUFBRSxJQUFJLEVBQUU7bUJBSXhELEtBQUssU0FBQyxpQkFBaUI7aUNBR3ZCLE1BQU0sU0FBQywrQkFBK0I7a0NBR3RDLE1BQU0sU0FBQywwQkFBMEI7aUNBR2pDLE1BQU0sU0FBQyx5QkFBeUI7cUJBR2hDLE1BQU0sU0FBQyxNQUFNO3NCQUdiLE1BQU0sU0FBQyxPQUFPOzRCQXlCZCxLQUFLLFNBQUMseUJBQXlCOzRCQVMvQixLQUFLLFNBQUMseUJBQXlCO3VCQVMvQixLQUFLLFNBQUMsMEJBQTBCOzRCQVNoQyxLQUFLLFNBQUMsNkJBQTZCO3lCQVNuQyxLQUFLLFNBQUMsNkJBQTZCIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtcbiAgQWZ0ZXJDb250ZW50SW5pdCxcbiAgQ29tcG9uZW50LFxuICBDb250ZW50Q2hpbGQsXG4gIENvbnRlbnRDaGlsZHJlbixcbiAgRWxlbWVudFJlZixcbiAgRXZlbnRFbWl0dGVyLFxuICBJbmplY3QsXG4gIEluamVjdGFibGUsXG4gIEluamVjdGlvblRva2VuLFxuICBJbnB1dCxcbiAgTmdab25lLFxuICBPbkNoYW5nZXMsXG4gIE9uRGVzdHJveSxcbiAgT3B0aW9uYWwsXG4gIE91dHB1dCxcbiAgUXVlcnlMaXN0LFxuICBSZW5kZXJlcjIsXG4gIFNpbXBsZUNoYW5nZXMsXG4gIFZpZXdFbmNhcHN1bGF0aW9uLFxufSBmcm9tIFwiQGFuZ3VsYXIvY29yZVwiO1xuaW1wb3J0IHsgRXZlbnRNYW5hZ2VyIH0gZnJvbSBcIkBhbmd1bGFyL3BsYXRmb3JtLWJyb3dzZXJcIjtcbmltcG9ydCB7IE1kbExheW91dEhlYWRlckNvbXBvbmVudCB9IGZyb20gXCIuL21kbC1sYXlvdXQtaGVhZGVyLmNvbXBvbmVudFwiO1xuaW1wb3J0IHsgTWRsTGF5b3V0RHJhd2VyQ29tcG9uZW50IH0gZnJvbSBcIi4vbWRsLWxheW91dC1kcmF3ZXIuY29tcG9uZW50XCI7XG5pbXBvcnQgeyBNZGxMYXlvdXRDb250ZW50Q29tcG9uZW50IH0gZnJvbSBcIi4vbWRsLWxheW91dC1jb250ZW50LmNvbXBvbmVudFwiO1xuaW1wb3J0IHsgQmVoYXZpb3JTdWJqZWN0LCBPYnNlcnZhYmxlLCBTdWJzY3JpcHRpb24gfSBmcm9tIFwicnhqc1wiO1xuaW1wb3J0IHsgdG9Cb29sZWFuIH0gZnJvbSBcIi4uL2NvbW1vbi9ib29sZWFuLXByb3BlcnR5XCI7XG5pbXBvcnQgeyB0b051bWJlciB9IGZyb20gXCIuLi9jb21tb24vbnVtYmVyLnByb3BlcnR5XCI7XG5pbXBvcnQgeyBNZGxFcnJvciB9IGZyb20gXCIuLi9jb21tb24vbWRsLWVycm9yXCI7XG5pbXBvcnQgeyBNZGxMYXlvdXRNZWRpYXRvclNlcnZpY2UgfSBmcm9tIFwiLi9tZGwtbGF5b3V0LW1lZGlhdG9yLnNlcnZpY2VcIjtcbmltcG9ydCB7IE1kbExheW91dFRhYlBhbmVsQ29tcG9uZW50IH0gZnJvbSBcIi4vbWRsLWxheW91dC10YWItcGFuZWwuY29tcG9uZW50XCI7XG5cbmNvbnN0IEVTQ0FQRSA9IDI3O1xuXG5jb25zdCBTVEFOREFSRCA9IFwic3RhbmRhcmRcIjtcbmNvbnN0IFdBVEVSRkFMTCA9IFwid2F0ZXJmYWxsXCI7XG5jb25zdCBTQ1JPTEwgPSBcInNjcm9sbFwiO1xuXG4vKipcbiAqIFRoZSBMQVlPVVRfU0NSRUVOX1NJWkVfVEhSRVNIT0xEIGNhbiBiZSBjaGFuZ2VkIGF0IHRoZSByb290IG1vZHVsZS4gSnVzdCBwcm92aWRlIGEgdmFsdWUgZm9yIHRoaXMgSW5qZWN0aW9uVG9rZW46XG4gKlxuICogcHJvdmlkZXJzOiBbXG4gKiAge3Byb3ZpZGU6TEFZT1VUX1NDUkVFTl9TSVpFX1RIUkVTSE9MRCwgdXNlVmFsdWU6IDc2OCB9XG4gKiBdXG4gKlxuICogeW91IGFsc28gbmVlZCB0byBjaGFuZ2UgdGhlIHNjc3MgdmFyaWFibGUgdG8gdGhlIHNhbWUgdmFsdWU6ICRsYXlvdXQtc2NyZWVuLXNpemUtdGhyZXNob2xkOiA3NjhweC5cbiAqXG4gKiBJdCBzaG91bGQgYmUgY2xlYXIgdGhhdCB0aGlzIGNhbiBvbmx5IGJlIHVzZWQgaWYgeW91IGFyZSB1c2luZyB0aGUgc2NzcyBhbmQgbm90IHRoZSBwcmUgY29tcGlsZWQgY3NzIGZyb20gZ2V0bWRsLmlvLlxuICpcbiAqL1xuZXhwb3J0IGNvbnN0IExBWU9VVF9TQ1JFRU5fU0laRV9USFJFU0hPTEQgPSBuZXcgSW5qZWN0aW9uVG9rZW48bnVtYmVyPihcbiAgXCJsYXlvdXRTY3JlZW5TaXplVGhyZXNob2xkXCJcbik7XG5cbmV4cG9ydCBjbGFzcyBNZExVbnN1cHBvcnRlZExheW91dFR5cGVFcnJvciBleHRlbmRzIE1kbEVycm9yIHtcbiAgY29uc3RydWN0b3IodHlwZTogc3RyaW5nKSB7XG4gICAgLyogaXN0YW5idWwgaWdub3JlIG5leHQgKi9cbiAgICBzdXBlcihcbiAgICAgIGBMYXlvdXQgdHlwZSBcIiR7dHlwZX1cIiBpc24ndCBzdXBwb3J0ZWQgYnkgbWRsLWxheW91dCAoYWxsb3dlZDogc3RhbmRhcmQsIHdhdGVyZmFsbCwgc2Nyb2xsKS5gXG4gICAgKTtcbiAgfVxufVxuXG5ASW5qZWN0YWJsZSh7XG4gIHByb3ZpZGVkSW46IFwicm9vdFwiLFxufSlcbmV4cG9ydCBjbGFzcyBNZGxTY3JlZW5TaXplU2VydmljZSB7XG4gIHByaXZhdGUgc2l6ZXNTdWJqZWN0OiBCZWhhdmlvclN1YmplY3Q8Ym9vbGVhbj4gPSBuZXcgQmVoYXZpb3JTdWJqZWN0KGZhbHNlKTtcbiAgcHJpdmF0ZSB3aW5kb3dNZWRpYVF1ZXJ5TGlzdGVuZXI6ICgpID0+IHZvaWQ7XG5cbiAgY29uc3RydWN0b3IoXG4gICAgbmdab25lOiBOZ1pvbmUsXG4gICAgQE9wdGlvbmFsKClcbiAgICBASW5qZWN0KExBWU9VVF9TQ1JFRU5fU0laRV9USFJFU0hPTEQpXG4gICAgcHVibGljIGxheW91dFNjcmVlblNpemVUaHJlc2hvbGQ6IG51bWJlclxuICApIHtcbiAgICAvLyBpZiBubyB2YWx1ZSBpcyBpbmplY3RlZCB0aGUgZGVmYXVsdCBzaXplIHdpbCBiZSB1c2VkLiBzYW1lIGFzICRsYXlvdXQtc2NyZWVuLXNpemUtdGhyZXNob2xkIGluIHNjc3NcbiAgICBpZiAoIXRoaXMubGF5b3V0U2NyZWVuU2l6ZVRocmVzaG9sZCkge1xuICAgICAgdGhpcy5sYXlvdXRTY3JlZW5TaXplVGhyZXNob2xkID0gMTAyNDtcbiAgICB9XG5cbiAgICAvLyBkbyBub3QgdHJ5IHRvIGFjY2VzcyB0aGUgd2luZG93IG9iamVjdCBpZiByZW5kZXJlZCBvbiB0aGUgc2VydmVyXG4gICAgaWYgKHR5cGVvZiB3aW5kb3cgPT09IFwib2JqZWN0XCIgJiYgXCJtYXRjaE1lZGlhXCIgaW4gd2luZG93KSB7XG4gICAgICBjb25zdCBxdWVyeTogTWVkaWFRdWVyeUxpc3QgPSB3aW5kb3cubWF0Y2hNZWRpYShcbiAgICAgICAgYChtYXgtd2lkdGg6ICR7dGhpcy5sYXlvdXRTY3JlZW5TaXplVGhyZXNob2xkfXB4KWBcbiAgICAgICk7XG5cbiAgICAgIGNvbnN0IHF1ZXJ5TGlzdGVuZXIgPSAoKSA9PiB7XG4gICAgICAgIG5nWm9uZS5ydW4oKCkgPT4ge1xuICAgICAgICAgIHRoaXMuc2l6ZXNTdWJqZWN0Lm5leHQocXVlcnkubWF0Y2hlcyk7XG4gICAgICAgIH0pO1xuICAgICAgfTtcbiAgICAgIC8vIC0gYWRkRXZlbnRMaXN0ZW5lciBub3Qgd29ya2luZyBpbiBTYWZhcmlcbiAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZVxuICAgICAgcXVlcnkuYWRkTGlzdGVuZXIocXVlcnlMaXN0ZW5lcik7XG4gICAgICB0aGlzLndpbmRvd01lZGlhUXVlcnlMaXN0ZW5lciA9ICgpID0+IHtcbiAgICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lXG4gICAgICAgIHF1ZXJ5LnJlbW92ZUxpc3RlbmVyKHF1ZXJ5TGlzdGVuZXIpO1xuICAgICAgfTtcbiAgICAgIC8vIHNldCB0aGUgaW5pdGlhbCBzdGF0ZVxuICAgICAgdGhpcy5zaXplc1N1YmplY3QubmV4dChxdWVyeS5tYXRjaGVzKTtcbiAgICB9XG4gIH1cblxuICBwdWJsaWMgaXNTbWFsbFNjcmVlbigpOiBib29sZWFuIHtcbiAgICByZXR1cm4gdGhpcy5zaXplc1N1YmplY3QudmFsdWU7XG4gIH1cblxuICBwdWJsaWMgc2l6ZXMoKTogT2JzZXJ2YWJsZTxib29sZWFuPiB7XG4gICAgcmV0dXJuIHRoaXMuc2l6ZXNTdWJqZWN0LmFzT2JzZXJ2YWJsZSgpO1xuICB9XG5cbiAgZGVzdHJveSgpOiB2b2lkIHtcbiAgICBpZiAodGhpcy53aW5kb3dNZWRpYVF1ZXJ5TGlzdGVuZXIpIHtcbiAgICAgIHRoaXMud2luZG93TWVkaWFRdWVyeUxpc3RlbmVyKCk7XG4gICAgICB0aGlzLndpbmRvd01lZGlhUXVlcnlMaXN0ZW5lciA9IG51bGw7XG4gICAgfVxuICB9XG59XG5cbkBDb21wb25lbnQoe1xuICBzZWxlY3RvcjogXCJtZGwtbGF5b3V0XCIsXG4gIHRlbXBsYXRlOiBgXG4gICAgPGRpdlxuICAgICAgY2xhc3M9XCJtZGwtbGF5b3V0X19jb250YWluZXJcIlxuICAgICAgW25nQ2xhc3NdPVwieyAnaGFzLXNjcm9sbGluZy1oZWFkZXInOiBtb2RlID09PSAnc2Nyb2xsJyB9XCJcbiAgICA+XG4gICAgICA8ZGl2XG4gICAgICAgIGNsYXNzPVwibWRsLWxheW91dCBpcy11cGdyYWRlZFwiXG4gICAgICAgIFtuZ0NsYXNzXT1cIntcbiAgICAgICAgICAnaXMtc21hbGwtc2NyZWVuJzogaXNTbWFsbFNjcmVlbixcbiAgICAgICAgICAnbWRsLWxheW91dC0tZml4ZWQtZHJhd2VyJzogaXNGaXhlZERyYXdlcixcbiAgICAgICAgICAnbWRsLWxheW91dC0tZml4ZWQtaGVhZGVyJzogaXNGaXhlZEhlYWRlcixcbiAgICAgICAgICAnbWRsLWxheW91dC0tZml4ZWQtdGFicyc6ICd0YWJzLnRvQXJyYXkoKS5sZW5ndGggPiAwJ1xuICAgICAgICB9XCJcbiAgICAgID5cbiAgICAgICAgPG5nLWNvbnRlbnQgc2VsZWN0PVwibWRsLWxheW91dC1oZWFkZXJcIj48L25nLWNvbnRlbnQ+XG4gICAgICAgIDxuZy1jb250ZW50IHNlbGVjdD1cIm1kbC1sYXlvdXQtZHJhd2VyXCI+PC9uZy1jb250ZW50PlxuICAgICAgICA8ZGl2XG4gICAgICAgICAgKm5nSWY9XCJkcmF3ZXJzLmxlbmd0aCA+IDAgJiYgaXNOb0RyYXdlciA9PSBmYWxzZVwiXG4gICAgICAgICAgY2xhc3M9XCJtZGwtbGF5b3V0X19kcmF3ZXItYnV0dG9uXCJcbiAgICAgICAgICAoY2xpY2spPVwidG9nZ2xlRHJhd2VyKClcIlxuICAgICAgICA+XG4gICAgICAgICAgPG1kbC1pY29uPiYjeEU1RDI7PC9tZGwtaWNvbj5cbiAgICAgICAgPC9kaXY+XG4gICAgICAgIDxuZy1jb250ZW50IHNlbGVjdD1cIm1kbC1sYXlvdXQtY29udGVudFwiPjwvbmctY29udGVudD5cbiAgICAgICAgPGRpdlxuICAgICAgICAgIGNsYXNzPVwibWRsLWxheW91dF9fb2JmdXNjYXRvclwiXG4gICAgICAgICAgW25nQ2xhc3NdPVwieyAnaXMtdmlzaWJsZSc6IGlzRHJhd2VyVmlzaWJsZSB9XCJcbiAgICAgICAgICAoY2xpY2spPVwidG9nZ2xlRHJhd2VyKClcIlxuICAgICAgICAgIChrZXlkb3duKT1cIm9iZnVzY2F0b3JLZXlEb3duKCRldmVudClcIlxuICAgICAgICA+PC9kaXY+XG4gICAgICA8L2Rpdj5cbiAgICA8L2Rpdj5cbiAgYCxcbiAgZXhwb3J0QXM6IFwibWRsTGF5b3V0XCIsXG4gIGVuY2Fwc3VsYXRpb246IFZpZXdFbmNhcHN1bGF0aW9uLk5vbmUsXG59KVxuZXhwb3J0IGNsYXNzIE1kbExheW91dENvbXBvbmVudFxuICBpbXBsZW1lbnRzIEFmdGVyQ29udGVudEluaXQsIE9uRGVzdHJveSwgT25DaGFuZ2VzIHtcbiAgQENvbnRlbnRDaGlsZChNZGxMYXlvdXRIZWFkZXJDb21wb25lbnQpXG4gIGhlYWRlcjtcbiAgLy8gd2lsbCBiZSBzZXQgdG8gdW5kZWZpbmVkLCBpZiBub3QgYSBkaXJlY3QgY2hpbGQgb3Igbm90IHByZXNlbnQgaW4gMi4wLjAgaVxuICAvLyBuIDIuMC4xIGl0IGlzIG5vdyB0aGUgZ3JhbmQgY2hpbGQgZHJhd2VyIGFnYWluIDooXG4gIEBDb250ZW50Q2hpbGRyZW4oTWRsTGF5b3V0RHJhd2VyQ29tcG9uZW50LCB7IGRlc2NlbmRhbnRzOiBmYWxzZSB9KVxuICBkcmF3ZXJzOiBRdWVyeUxpc3Q8TWRsTGF5b3V0RHJhd2VyQ29tcG9uZW50PjtcbiAgQENvbnRlbnRDaGlsZChNZGxMYXlvdXRDb250ZW50Q29tcG9uZW50LCB7IHN0YXRpYzogdHJ1ZSB9KVxuICBjb250ZW50O1xuXG4gIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZVxuICBASW5wdXQoJ21kbC1sYXlvdXQtbW9kZScpXG4gIG1vZGU6IHN0cmluZyA9IFNUQU5EQVJEO1xuICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmVcbiAgQE91dHB1dCgnbWRsLWxheW91dC10YWItYWN0aXZlLWNoYW5nZWQnKVxuICBzZWxlY3RlZFRhYkVtaXR0ZXIgPSBuZXcgRXZlbnRFbWl0dGVyKCk7XG4gIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZVxuICBAT3V0cHV0KCdtZGwtbGF5b3V0LXRhYi1tb3VzZW92ZXInKVxuICBtb3VzZW92ZXJUYWJFbWl0dGVyID0gbmV3IEV2ZW50RW1pdHRlcigpO1xuICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmVcbiAgQE91dHB1dCgnbWRsLWxheW91dC10YWItbW91c2VvdXQnKVxuICBtb3VzZW91dFRhYkVtaXR0ZXIgPSBuZXcgRXZlbnRFbWl0dGVyKCk7XG4gIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZVxuICBAT3V0cHV0KCdvcGVuJylcbiAgb25PcGVuID0gbmV3IEV2ZW50RW1pdHRlcjx2b2lkPigpO1xuICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmVcbiAgQE91dHB1dCgnY2xvc2UnKVxuICBvbkNsb3NlID0gbmV3IEV2ZW50RW1pdHRlcjx2b2lkPigpO1xuICBpc0RyYXdlclZpc2libGUgPSBmYWxzZTtcbiAgaXNTbWFsbFNjcmVlbiA9IGZhbHNlO1xuICBwcml2YXRlIHNjcm9sbExpc3RlbmVyOiAoXG4gICAgdGFyZ2V0PzogXCJ3aW5kb3dcIiB8IFwiZG9jdW1lbnRcIiB8IFwiYm9keVwiIHwgdW5rbm93bixcbiAgICBldmVudE5hbWU/OiBzdHJpbmcsXG4gICAgY2FsbGJhY2s/OiAoZXZlbnQ6IEV2ZW50KSA9PiBib29sZWFuIHwgdm9pZFxuICApID0+IHZvaWQ7XG4gIHByaXZhdGUgaXNGaXhlZERyYXdlckludGVybiA9IGZhbHNlO1xuICBwcml2YXRlIGlzRml4ZWRIZWFkZXJJbnRlcm4gPSBmYWxzZTtcbiAgcHJpdmF0ZSBpc1NlYW1lZEludGVybiA9IGZhbHNlO1xuICBwcml2YXRlIHNlbGVjdGVkSW5kZXhJbnRlcm4gPSAwO1xuICBwcml2YXRlIGlzTm9EcmF3ZXJJbnRlcm4gPSBmYWxzZTtcblxuICBwcml2YXRlIHN1YnNjcmlwdGlvbnM6IFN1YnNjcmlwdGlvbltdID0gW107XG5cbiAgY29uc3RydWN0b3IoXG4gICAgcHJpdmF0ZSByZW5kZXJlcjogUmVuZGVyZXIyLFxuICAgIHByaXZhdGUgZXZtOiBFdmVudE1hbmFnZXIsXG4gICAgcHJpdmF0ZSBlbDogRWxlbWVudFJlZixcbiAgICBwcml2YXRlIHNjcmVlblNpemVTZXJ2aWNlOiBNZGxTY3JlZW5TaXplU2VydmljZSxcbiAgICBwcml2YXRlIGxheW91dE1lZGlhdG9yU2VydmljZTogTWRsTGF5b3V0TWVkaWF0b3JTZXJ2aWNlXG4gICkge31cblxuICBASW5wdXQoXCJtZGwtbGF5b3V0LWZpeGVkLWRyYXdlclwiKVxuICBnZXQgaXNGaXhlZERyYXdlcigpOiBib29sZWFuIHtcbiAgICByZXR1cm4gdGhpcy5pc0ZpeGVkRHJhd2VySW50ZXJuO1xuICB9XG5cbiAgc2V0IGlzRml4ZWREcmF3ZXIodmFsdWU6IGJvb2xlYW4pIHtcbiAgICB0aGlzLmlzRml4ZWREcmF3ZXJJbnRlcm4gPSB0b0Jvb2xlYW4odmFsdWUpO1xuICB9XG5cbiAgQElucHV0KFwibWRsLWxheW91dC1maXhlZC1oZWFkZXJcIilcbiAgZ2V0IGlzRml4ZWRIZWFkZXIoKTogYm9vbGVhbiB7XG4gICAgcmV0dXJuIHRoaXMuaXNGaXhlZEhlYWRlckludGVybjtcbiAgfVxuXG4gIHNldCBpc0ZpeGVkSGVhZGVyKHZhbHVlOiBib29sZWFuKSB7XG4gICAgdGhpcy5pc0ZpeGVkSGVhZGVySW50ZXJuID0gdG9Cb29sZWFuKHZhbHVlKTtcbiAgfVxuXG4gIEBJbnB1dChcIm1kbC1sYXlvdXQtaGVhZGVyLXNlYW1lZFwiKVxuICBnZXQgaXNTZWFtZWQoKTogYm9vbGVhbiB7XG4gICAgcmV0dXJuIHRoaXMuaXNTZWFtZWRJbnRlcm47XG4gIH1cblxuICBzZXQgaXNTZWFtZWQodmFsdWU6IGJvb2xlYW4pIHtcbiAgICB0aGlzLmlzU2VhbWVkSW50ZXJuID0gdG9Cb29sZWFuKHZhbHVlKTtcbiAgfVxuXG4gIEBJbnB1dChcIm1kbC1sYXlvdXQtdGFiLWFjdGl2ZS1pbmRleFwiKVxuICBnZXQgc2VsZWN0ZWRJbmRleCgpOiBudW1iZXIge1xuICAgIHJldHVybiB0aGlzLnNlbGVjdGVkSW5kZXhJbnRlcm47XG4gIH1cblxuICBzZXQgc2VsZWN0ZWRJbmRleCh2YWx1ZTogbnVtYmVyKSB7XG4gICAgdGhpcy5zZWxlY3RlZEluZGV4SW50ZXJuID0gdG9OdW1iZXIodmFsdWUpO1xuICB9XG5cbiAgQElucHV0KFwibWRsLWxheW91dC1uby1kcmF3ZXItYnV0dG9uXCIpXG4gIGdldCBpc05vRHJhd2VyKCk6IGJvb2xlYW4ge1xuICAgIHJldHVybiB0aGlzLmlzTm9EcmF3ZXJJbnRlcm47XG4gIH1cblxuICBzZXQgaXNOb0RyYXdlcih2YWx1ZTogYm9vbGVhbikge1xuICAgIHRoaXMuaXNOb0RyYXdlckludGVybiA9IHRvQm9vbGVhbih2YWx1ZSk7XG4gIH1cblxuICBuZ0FmdGVyQ29udGVudEluaXQoKTogdm9pZCB7XG4gICAgdGhpcy52YWxpZGF0ZU1vZGUoKTtcblxuICAgIGlmICh0aGlzLmhlYWRlciAmJiB0aGlzLmNvbnRlbnQgJiYgdGhpcy5jb250ZW50LnRhYnMpIHtcbiAgICAgIHRoaXMuaGVhZGVyLnRhYnMgPSB0aGlzLmNvbnRlbnQudGFicztcbiAgICAgIHRoaXMudXBkYXRlU2VsZWN0ZWRUYWJJbmRleCgpO1xuICAgIH1cblxuICAgIGlmICh0aGlzLmhlYWRlciAmJiB0aGlzLmhlYWRlci50YWJzKSB7XG4gICAgICB0aGlzLnN1YnNjcmlwdGlvbnMucHVzaChcbiAgICAgICAgdGhpcy5sYXlvdXRNZWRpYXRvclNlcnZpY2VcbiAgICAgICAgICAub25UYWJNb3VzZU91dCgpXG4gICAgICAgICAgLnN1YnNjcmliZSgodGFiOiBNZGxMYXlvdXRUYWJQYW5lbENvbXBvbmVudCkgPT4ge1xuICAgICAgICAgICAgdGhpcy5vblRhYk1vdXNlb3V0KHRhYik7XG4gICAgICAgICAgfSlcbiAgICAgICk7XG5cbiAgICAgIHRoaXMuc3Vic2NyaXB0aW9ucy5wdXNoKFxuICAgICAgICB0aGlzLmxheW91dE1lZGlhdG9yU2VydmljZVxuICAgICAgICAgIC5vblRhYk1vdXNlb3ZlcigpXG4gICAgICAgICAgLnN1YnNjcmliZSgodGFiOiBNZGxMYXlvdXRUYWJQYW5lbENvbXBvbmVudCkgPT4ge1xuICAgICAgICAgICAgdGhpcy5vblRhYk1vdXNlb3Zlcih0YWIpO1xuICAgICAgICAgIH0pXG4gICAgICApO1xuXG4gICAgICB0aGlzLnN1YnNjcmlwdGlvbnMucHVzaChcbiAgICAgICAgdGhpcy5sYXlvdXRNZWRpYXRvclNlcnZpY2VcbiAgICAgICAgICAub25UYWJTZWxlY3RlZCgpXG4gICAgICAgICAgLnN1YnNjcmliZSgodGFiOiBNZGxMYXlvdXRUYWJQYW5lbENvbXBvbmVudCkgPT4ge1xuICAgICAgICAgICAgdGhpcy50YWJTZWxlY3RlZCh0YWIpO1xuICAgICAgICAgIH0pXG4gICAgICApO1xuICAgIH1cbiAgfVxuXG4gIHB1YmxpYyBuZ09uQ2hhbmdlcyhjaGFuZ2VzOiBTaW1wbGVDaGFuZ2VzKTogdm9pZCB7XG4gICAgaWYgKGNoYW5nZXMuc2VsZWN0ZWRJbmRleCkge1xuICAgICAgdGhpcy51cGRhdGVTZWxlY3RlZFRhYkluZGV4KCk7XG4gICAgfVxuICB9XG5cbiAgdG9nZ2xlRHJhd2VyKCk6IHZvaWQge1xuICAgIHRoaXMuaXNEcmF3ZXJWaXNpYmxlID0gIXRoaXMuaXNEcmF3ZXJWaXNpYmxlO1xuICAgIGlmICh0aGlzLmRyYXdlcnMubGVuZ3RoID4gMCkge1xuICAgICAgdGhpcy5zZXREcmF3ZXJWaXNpYmxlKHRoaXMuaXNEcmF3ZXJWaXNpYmxlKTtcbiAgICB9XG4gIH1cblxuICBjbG9zZURyYXdlcigpOiB2b2lkIHtcbiAgICB0aGlzLmlzRHJhd2VyVmlzaWJsZSA9IGZhbHNlO1xuICAgIGlmICh0aGlzLmRyYXdlcnMubGVuZ3RoID4gMCkge1xuICAgICAgdGhpcy5zZXREcmF3ZXJWaXNpYmxlKGZhbHNlKTtcbiAgICB9XG4gIH1cblxuICBvcGVuRHJhd2VyKCk6IHZvaWQge1xuICAgIHRoaXMuaXNEcmF3ZXJWaXNpYmxlID0gdHJ1ZTtcbiAgICBpZiAodGhpcy5kcmF3ZXJzLmxlbmd0aCA+IDApIHtcbiAgICAgIHRoaXMuc2V0RHJhd2VyVmlzaWJsZSh0cnVlKTtcbiAgICB9XG4gIH1cblxuICBvYmZ1c2NhdG9yS2V5RG93bigkZXZlbnQ6IEtleWJvYXJkRXZlbnQpOiB2b2lkIHtcbiAgICBpZiAoJGV2ZW50LmtleUNvZGUgPT09IEVTQ0FQRSkge1xuICAgICAgdGhpcy50b2dnbGVEcmF3ZXIoKTtcbiAgICB9XG4gIH1cblxuICBuZ09uRGVzdHJveSgpOiB2b2lkIHtcbiAgICBpZiAodGhpcy5zY3JvbGxMaXN0ZW5lcikge1xuICAgICAgdGhpcy5zY3JvbGxMaXN0ZW5lcigpO1xuICAgICAgdGhpcy5zY3JvbGxMaXN0ZW5lciA9IG51bGw7XG4gICAgfVxuICAgIHRoaXMuc3Vic2NyaXB0aW9ucy5mb3JFYWNoKChzdWIpID0+IHN1Yi51bnN1YnNjcmliZSgpKTtcbiAgfVxuXG4gIGNsb3NlRHJhd2VyT25TbWFsbFNjcmVlbnMoKTogdm9pZCB7XG4gICAgaWYgKHRoaXMuaXNTbWFsbFNjcmVlbiAmJiB0aGlzLmlzRHJhd2VyVmlzaWJsZSkge1xuICAgICAgdGhpcy5jbG9zZURyYXdlcigpO1xuICAgIH1cbiAgfVxuXG4gIG9wZW5EcmF3ZXJPblNtYWxsU2NyZWVucygpOiB2b2lkIHtcbiAgICBpZiAodGhpcy5pc1NtYWxsU2NyZWVuICYmICF0aGlzLmlzRHJhd2VyVmlzaWJsZSkge1xuICAgICAgdGhpcy5vcGVuRHJhd2VyKCk7XG4gICAgfVxuICB9XG5cbiAgaGFzRHJhd2VyKCk6IGJvb2xlYW4ge1xuICAgIHJldHVybiB0aGlzLmRyYXdlcnMubGVuZ3RoID4gMDtcbiAgfVxuXG4gIHByaXZhdGUgdGFiU2VsZWN0ZWQodGFiOiBNZGxMYXlvdXRUYWJQYW5lbENvbXBvbmVudCkge1xuICAgIGNvbnN0IGluZGV4ID0gdGhpcy5oZWFkZXIudGFicy50b0FycmF5KCkuaW5kZXhPZih0YWIpO1xuICAgIGlmIChpbmRleCAhPT0gdGhpcy5zZWxlY3RlZEluZGV4KSB7XG4gICAgICB0aGlzLnNlbGVjdGVkSW5kZXggPSBpbmRleDtcbiAgICAgIHRoaXMudXBkYXRlU2VsZWN0ZWRUYWJJbmRleCgpO1xuICAgICAgdGhpcy5zZWxlY3RlZFRhYkVtaXR0ZXIuZW1pdCh7IGluZGV4OiB0aGlzLnNlbGVjdGVkSW5kZXggfSk7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBvblRhYk1vdXNlb3Zlcih0YWI6IE1kbExheW91dFRhYlBhbmVsQ29tcG9uZW50KSB7XG4gICAgY29uc3QgaW5kZXggPSB0aGlzLmhlYWRlci50YWJzLnRvQXJyYXkoKS5pbmRleE9mKHRhYik7XG4gICAgdGhpcy5tb3VzZW92ZXJUYWJFbWl0dGVyLmVtaXQoeyBpbmRleCB9KTtcbiAgfVxuXG4gIHByaXZhdGUgb25UYWJNb3VzZW91dCh0YWI6IE1kbExheW91dFRhYlBhbmVsQ29tcG9uZW50KSB7XG4gICAgY29uc3QgaW5kZXggPSB0aGlzLmhlYWRlci50YWJzLnRvQXJyYXkoKS5pbmRleE9mKHRhYik7XG4gICAgdGhpcy5tb3VzZW91dFRhYkVtaXR0ZXIuZW1pdCh7IGluZGV4IH0pO1xuICB9XG5cbiAgcHJpdmF0ZSB1cGRhdGVTZWxlY3RlZFRhYkluZGV4KCkge1xuICAgIGlmICh0aGlzLmhlYWRlciAmJiB0aGlzLmhlYWRlci50YWJzKSB7XG4gICAgICB0aGlzLmhlYWRlci50YWJzLmZvckVhY2goKHRhYikgPT4gKHRhYi5pc0FjdGl2ZSA9IGZhbHNlKSk7XG4gICAgICBpZiAoXG4gICAgICAgIHRoaXMuaGVhZGVyLnRhYnMudG9BcnJheSgpLmxlbmd0aCA+IDAgJiZcbiAgICAgICAgdGhpcy5zZWxlY3RlZEluZGV4IDwgdGhpcy5oZWFkZXIudGFicy50b0FycmF5KCkubGVuZ3RoXG4gICAgICApIHtcbiAgICAgICAgdGhpcy5oZWFkZXIudGFicy50b0FycmF5KClbdGhpcy5zZWxlY3RlZEluZGV4XS5pc0FjdGl2ZSA9IHRydWU7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSB2YWxpZGF0ZU1vZGUoKSB7XG4gICAgaWYgKHRoaXMubW9kZSA9PT0gXCJcIikge1xuICAgICAgdGhpcy5tb2RlID0gU1RBTkRBUkQ7XG4gICAgfVxuICAgIGlmIChbU1RBTkRBUkQsIFdBVEVSRkFMTCwgU0NST0xMXS5pbmRleE9mKHRoaXMubW9kZSkgPT09IC0xKSB7XG4gICAgICB0aHJvdyBuZXcgTWRMVW5zdXBwb3J0ZWRMYXlvdXRUeXBlRXJyb3IodGhpcy5tb2RlKTtcbiAgICB9XG5cbiAgICBpZiAodGhpcy5oZWFkZXIpIHtcbiAgICAgIC8vIGluZm9ybSB0aGUgaGVhZGVyIGFib3V0IHRoZSBtb2RlXG4gICAgICB0aGlzLmhlYWRlci5tb2RlID0gdGhpcy5tb2RlO1xuICAgICAgdGhpcy5oZWFkZXIuaXNTZWFtZWQgPSB0aGlzLmlzU2VhbWVkO1xuICAgIH1cblxuICAgIGlmICh0aGlzLmNvbnRlbnQpIHtcbiAgICAgIHRoaXMuc2Nyb2xsTGlzdGVuZXIgPSB0aGlzLnJlbmRlcmVyLmxpc3RlbihcbiAgICAgICAgdGhpcy5jb250ZW50LmVsLFxuICAgICAgICBcInNjcm9sbFwiLFxuICAgICAgICAoKSA9PiB7XG4gICAgICAgICAgdGhpcy5vblNjcm9sbCh0aGlzLmNvbnRlbnQuZWwuc2Nyb2xsVG9wKTtcbiAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgfVxuICAgICAgKTtcblxuICAgICAgdGhpcy5zY3JlZW5TaXplU2VydmljZS5zaXplcygpLnN1YnNjcmliZSgoaXNTbWFsbDogYm9vbGVhbikgPT4ge1xuICAgICAgICB0aGlzLm9uUXVlcnlDaGFuZ2UoaXNTbWFsbCk7XG4gICAgICB9KTtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIG9uU2Nyb2xsKHNjcm9sbFRvcCkge1xuICAgIGlmICh0aGlzLm1vZGUgIT09IFdBVEVSRkFMTCkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGlmICh0aGlzLmhlYWRlci5pc0FuaW1hdGluZykge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGNvbnN0IGhlYWRlclZpc2libGUgPSAhdGhpcy5pc1NtYWxsU2NyZWVuIHx8IHRoaXMuaXNGaXhlZEhlYWRlcjtcbiAgICBpZiAoc2Nyb2xsVG9wID4gMCAmJiAhdGhpcy5oZWFkZXIuaXNDb21wYWN0KSB7XG4gICAgICB0aGlzLmhlYWRlci5pc0NvbXBhY3QgPSB0cnVlO1xuICAgICAgaWYgKGhlYWRlclZpc2libGUpIHtcbiAgICAgICAgdGhpcy5oZWFkZXIuaXNBbmltYXRpbmcgPSB0cnVlO1xuICAgICAgfVxuICAgIH0gZWxzZSBpZiAoc2Nyb2xsVG9wIDw9IDAgJiYgdGhpcy5oZWFkZXIuaXNDb21wYWN0KSB7XG4gICAgICB0aGlzLmhlYWRlci5pc0NvbXBhY3QgPSBmYWxzZTtcbiAgICAgIGlmIChoZWFkZXJWaXNpYmxlKSB7XG4gICAgICAgIHRoaXMuaGVhZGVyLmlzQW5pbWF0aW5nID0gdHJ1ZTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICBwcml2YXRlIG9uUXVlcnlDaGFuZ2UoaXNTbWFsbDogYm9vbGVhbikge1xuICAgIGlmIChpc1NtYWxsKSB7XG4gICAgICB0aGlzLmlzU21hbGxTY3JlZW4gPSB0cnVlO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLmlzU21hbGxTY3JlZW4gPSBmYWxzZTtcbiAgICAgIHRoaXMuY2xvc2VEcmF3ZXIoKTtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIHNldERyYXdlclZpc2libGUodmlzaWJsZTogYm9vbGVhbikge1xuICAgIHRoaXMuZHJhd2Vycy5maXJzdC5pc0RyYXdlclZpc2libGUgPSB2aXNpYmxlO1xuICAgIGlmICh0aGlzLmRyYXdlcnMuZmlyc3QuaXNEcmF3ZXJWaXNpYmxlKSB7XG4gICAgICB0aGlzLm9uT3Blbi5lbWl0KCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMub25DbG9zZS5lbWl0KCk7XG4gICAgfVxuICB9XG59XG4iXX0=